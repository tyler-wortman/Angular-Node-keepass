(function(){var f,c;f=angular.module("builder.controller",["builder.provider"]);c=function(b,a){return a.get("$builder")};c.$inject=["$scope","$injector"];f.controller("fbBuilderController",c);c=function(b,a){var g;g=a.get("$builder");b.selectGroup=function(a,d){var e,c,h,l;null!=a&&a.preventDefault();b.activeGroup=d;b.components=[];h=g.components;l=[];for(c in h)e=h[c],e.group===d&&l.push(b.components.push(e));return l};b.groups=g.groups;b.activeGroup=b.groups[0];b.allComponents=g.components;return b.$watch("allComponents",
function(){return b.selectGroup(null,b.activeGroup)})};c.$inject=["$scope","$injector"];f.controller("fbComponentsController",c);c=function(b,a){return a.get("$builder")};c.$inject=["$scope","$injector"];f.controller("fbFormController",c)}).call(this);
(function(){var f,c;f=angular.module("builder.directive",["builder.provider","builder.controller","builder.drag","validator"]);c=function(b){return{restrict:"A",template:"<div class='form-horizontal'>\n    <div class='fb-form-object-editable' ng-repeat=\"object in formObjects\"\n        fb-form-object-editable=\"object\"></div>\n</div>",controller:"fbBuilderController",link:function(a,g,k){var d,e,c,h,l;d=b.get("$builder");e=b.get("$drag");h=k.fbBuilder;null==(l=d.forms)[h]&&(l[h]=[]);a.formObjects=
d.forms[h];c=!0;$(g).addClass("fb-builder");return e.droppable($(g),{move:function(e,k){var b,d,h,l,f,p;c&&($("div.fb-form-object-editable").popover("hide"),c=!1);h=$(g).find(".fb-form-object-editable:not(.empty,.dragging)");if(0===h.length)0===$(g).find(".fb-form-object-editable.empty").length&&$(g).find(">div:first").append($("<div class='fb-form-object-editable empty'></div>"));else{b=[];b.push(-1E3);l=f=0;for(p=h.length-1;f<=p;l=f+=1)d=$(h[l]),l=d.offset(),d=d.height(),b.push(l.top+d/2);b.push(b[b.length-
1]+1E3);f=-1;for(l=p=a.formObjects.length-1;0<=p;l=p+=-1)if(!a.formObjects[l].editable){f=l;break}l=f=0<=f?f+2:1;for(p=b.length-1;f<=p;l=f+=1)if(e.pageY>b[l-1]&&e.pageY<=b[l]){$(g).find(".empty").remove();b=$("<div class='fb-form-object-editable empty'></div>");l-1<h.length?b.insertBefore($(h[l-1])):b.insertAfter($(h[l-2]));break}}},out:function(a,b){c&&($("div.fb-form-object-editable").popover("hide"),c=!1);return $(g).find(".empty").remove()},up:function(a,b,l){c=!0;if(e.isMouseMoved())return b||
"drag"!==l.mode?b&&("mirror"===l.mode&&d.insertFormObject(h,$(g).find(".empty").index(".fb-form-object-editable"),{component:l.object.componentName}),"drag"===l.mode&&(b=l.object.formObject.index,a=$(g).find(".empty").index(".fb-form-object-editable"),b<a&&a--,d.updateFormObjectIndex(h,b,a))):(a=l.object.formObject,d.removeFormObject(k.fbBuilder,a.index)),$(g).find(".empty").remove();$(g).find(".empty").remove()}})}}};c.$inject=["$injector"];f.directive("fbBuilder",c);c=function(b){return{restrict:"A",
link:function(a,g,k){var d,e,c,h,l,q,n,m,f;c=b.get("$builder");l=b.get("$drag");q=b.get("$parse");h=b.get("$compile");n=b.get("$validator");m=q(k.fbFormObjectEditable)(a);k=c.components[m.component];for(e in m)q=m[e],"$$hashKey"!==e&&(a[e]=q);a.optionsText=m.options.join("\n");a.$watch("[label, description, placeholder, required, options]",function(){m.label=a.label;m.description=a.description;m.placeholder=a.placeholder;m.required=a.required;return m.options=a.options},!0);a.$watch("optionsText",
function(g){var b,e,k,d;k=g.split("\n");d=[];b=0;for(e=k.length;b<e;b++)g=k[b],0<g.length&&d.push(g);a.options=d;return a.inputText=a.options[0]});e=$(k.template);e=h(e)(a);$(g).append(e);$(g).on("click",function(){return!1});if(m.editable)return l.draggable($(g),{object:{formObject:m}}),f="fb-"+Math.random().toString().substr(2),d=!1,e=null,e=k.popoverTemplate,e=$(e).addClass(f),a.popover={ngModel:null,save:function(b){b.preventDefault();n.validate(a).success(function(){d=!0;return $(g).popover("hide")})},
remove:function(b){b.preventDefault();b=$(g).closest("[fb-builder]").attr("fb-builder");c.removeFormObject(b,a.$index);$(g).popover("hide")},shown:function(){this.ngModel={label:a.label,description:a.description,placeholder:a.placeholder,required:a.required,optionsText:a.optionsText};return d=!1},cancel:function(b){this.ngModel&&(a.label=this.ngModel.label,a.description=this.ngModel.description,a.placeholder=this.ngModel.placeholder,a.required=this.ngModel.required,a.optionsText=this.ngModel.optionsText);
b&&(b.preventDefault(),$(g).popover("hide"))}},e=h(e)(a),$(g).addClass(f),$(g).popover({html:!0,title:k.label,content:e,container:"body"}),$(g).on("show.bs.popover",function(){var a,b;if(l.isMouseMoved())return!1;$("div.fb-form-object-editable:not(."+f+")").popover("hide");a=$("form."+f).closest(".popover");if(0<a.length)return b=$(g).offset().top+$(g).height()/2,b-=a.height()/2,a.css({position:"absolute",top:b}),a.show(),setTimeout(function(){a.addClass("in");return $(g).triggerHandler("shown.bs.popover")},
0),!1}),$(g).on("shown.bs.popover",function(){$(".popover ."+f+" input:first").select();a.$apply(function(){return a.popover.shown()})}),$(g).on("hide.bs.popover",function(){var g;g=$("form."+f).closest(".popover");d||(a.$$phase?a.popover.cancel():a.$apply(function(){return a.popover.cancel()}));g.removeClass("in");setTimeout(function(){return g.hide()},300);return!1})}}};c.$inject=["$injector"];f.directive("fbFormObjectEditable",c);f.directive("fbComponents",function(){return{restrict:"A",template:'<ul ng-if="groups.length > 1" class="nav nav-tabs nav-justified">\n    <li ng-repeat="group in groups" ng-class="{active:activeGroup==group}">\n        <a href=\'#\' ng-click="selectGroup($event, group)">{{group}}</a>\n    </li>\n</ul>\n<div class=\'form-horizontal\'>\n    <div class=\'fb-component\' ng-repeat="component in components"\n        fb-component="component"></div>\n</div>',
controller:"fbComponentsController"}});c=function(b){return{restrict:"A",link:function(a,g,k){var d,e,c,h;b.get("$builder");e=b.get("$drag");c=b.get("$parse");d=b.get("$compile");h=a.$new();a=c(k.fbComponent)(a);$.extend(h,a);e.draggable($(g),{mode:"mirror",defer:!1,object:{componentName:a.name}});e=$(a.template);d=d(e)(h);return $(g).append(d)}}};c.$inject=["$injector"];f.directive("fbComponent",c);c=function(b){return{restrict:"A",require:"ngModel",scope:{input:"=ngModel"},template:'<div class=\'fb-form-object\' ng-repeat="object in form" fb-form-object="object">\n</div>',
controller:"fbFormController",link:function(a,g,k){var d,e;d=b.get("$builder");e=b.get("$timeout");a.form=d.forms[k.fbForm];return a.$watch("form",function(){a.input.length>a.form.length&&a.input.splice(a.form.length);return e(function(){return a.$broadcast(d.broadcastChannel.updateInput)})},!0)}}};c.$inject=["$injector"];f.directive("fbForm",c);c=function(b){return{restrict:"A",link:function(a,g,k){var d,e,c,h,l,f;d=b.get("$builder");e=b.get("$compile");l=b.get("$parse")(k.fbFormObject)(a);c=d.components[l.component];
f=function(g){return a.$parent.input.splice(a.$index,1,{id:l.id,label:l.label,value:null!=g?g:""})};h=function(){var g,b,e;e=[];for(g in l)b=l[g],"$$hashKey"!==g&&e.push(a[g]=b);return e};a.$on(d.broadcastChannel.updateInput,function(){return f(a.inputText)});c.arrayToText&&(a.inputArray=[],a.$watch("inputArray",function(g,b){var e,k;if(g!==b){e=[];for(k in a.inputArray)a.inputArray[k]&&e.push(a.options[k]);return a.inputText=e.join(", ")}},!0));a.$watch("inputText",function(){return f(a.inputText)});
a.$watch(k.fbFormObject,function(){return h()},!0);k=$(c.template);k.find("[ng-model='inputText']").attr({validator:"{{validation}}","validator-error":"{{errorMessage}}"});e=e(k)(a);$(g).append(e);if(!c.arrayToText&&0<l.options.length)return a.inputText=l.options[0]}}};c.$inject=["$injector"];f.directive("fbFormObject",c)}).call(this);
(function(){angular.module("builder.drag",[]).provider("$drag",function(){var f,c,b,a=this;c=f=null;this.data={draggables:{},droppables:{}};this.mouseMoved=!1;this.isMouseMoved=function(){return a.mouseMoved};this.hooks={down:{},move:{},up:{}};this.eventMouseMove=function(){};this.eventMouseUp=function(){};$(function(){$(document).on("mousedown",function(g){var b,d,e;a.mouseMoved=!1;e=a.hooks.down;for(d in e)b=e[d],b(g)});$(document).on("mousemove",function(g){var b,d,e;a.mouseMoved=!0;e=a.hooks.move;
for(d in e)b=e[d],b(g)});return $(document).on("mouseup",function(g){var b,d,e;e=a.hooks.up;for(d in e)b=e[d],b(g)})});this.currentId=0;this.getNewId=function(){return""+a.currentId++};this.setupEasing=function(){return jQuery.extend(jQuery.easing,{easeOutQuad:function(a,b,d,e,c){return-e*(b/=c)*(b-2)+d}})};this.setupProviders=function(a){f=a;return c=f.get("$rootScope")};this.isHover=function(a,b){var d,e,c,h,l,f,n;f=a.offset();n=b.offset();c=a.width();h=a.height();d=b.width();e=b.height();l={x:!1,
y:!1};l.x=f.left>n.left&&f.left<n.left+d;l.x=l.x||f.left+c>n.left&&f.left+c<n.left+d;if(!l)return!1;l.y=f.top>n.top&&f.top<n.top+e;l.y=l.y||f.top+h>n.top&&f.top+h<n.top+e;return l.x&&l.y};b=function(a,b){return setTimeout(function(){return b()},a)};this.autoScroll={up:!1,down:!1,scrolling:!1,scroll:function(){a.autoScroll.scrolling=!0;return a.autoScroll.up?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()-50},100,"easeOutQuad"),b(100,function(){return a.autoScroll.scroll()})):a.autoScroll.down?
($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()+50},100,"easeOutQuad"),b(100,function(){return a.autoScroll.scroll()})):a.autoScroll.scrolling=!1},start:function(b){if(50>b.clientY){if(a.autoScroll.up=!0,a.autoScroll.down=!1,!a.autoScroll.scrolling)return a.autoScroll.scroll()}else if(b.clientY>$(window).innerHeight()-50){if(a.autoScroll.up=!1,a.autoScroll.down=!0,!a.autoScroll.scrolling)return a.autoScroll.scroll()}else return a.autoScroll.up=!1,a.autoScroll.down=!1}};this.dragMirrorMode=
function(b,c,d){var e;null==c&&(c=!0);e={id:a.getNewId(),mode:"mirror",maternal:b[0],element:null,object:d};b.on("mousedown",function(d){var h;d.preventDefault();h=b.clone();e.element=h[0];h.addClass("fb-draggable form-horizontal prepare-dragging");a.hooks.move.drag=function(d,c){var k,f,r,s;if(h.hasClass("prepare-dragging")&&(h.css({width:b.width(),height:b.height()}),h.removeClass("prepare-dragging"),h.addClass("dragging"),c))return;h.offset({left:d.pageX-h.width()/2,top:d.pageY-h.height()/2});
a.autoScroll.start(d);r=a.data.droppables;s=[];for(f in r)k=r[f],a.isHover(h,$(k.element))?s.push(k.move(d,e)):s.push(k.out(d,e));return s};a.hooks.up.drag=function(b){var g,d,c,k;k=a.data.droppables;for(d in k)g=k[d],c=a.isHover(h,$(g.element)),g.up(b,c,e);delete a.hooks.move.drag;delete a.hooks.up.drag;e.element=null;return h.remove()};$("body").append(h);if(!c)return a.hooks.move.drag(d,c)});return e};this.dragDragMode=function(b,c,d){var e;null==c&&(c=!0);e={id:a.getNewId(),mode:"drag",maternal:null,
element:b[0],object:d};b.addClass("fb-draggable");b.on("mousedown",function(d){d.preventDefault();if(!b.hasClass("dragging")&&(b.addClass("prepare-dragging"),a.hooks.move.drag=function(d,c){var k,f,m;if(b.hasClass("prepare-dragging")&&(b.css({width:b.width(),height:b.height()}),b.removeClass("prepare-dragging"),b.addClass("dragging"),c))return;b.offset({left:d.pageX-b.width()/2,top:d.pageY-b.height()/2});a.autoScroll.start(d);m=a.data.droppables;for(f in m)k=m[f],a.isHover(b,$(k.element))?k.move(d,
e):k.out(d,e)},a.hooks.up.drag=function(d){var c,k,f,m;m=a.data.droppables;for(k in m)c=m[k],f=a.isHover(b,$(c.element)),c.up(d,f,e);delete a.hooks.move.drag;delete a.hooks.up.drag;b.css({width:"",height:"",left:"",top:""});return b.removeClass("dragging defer-dragging")},!c))return a.hooks.move.drag(d,c)});return e};this.dropMode=function(b,k){return{id:a.getNewId(),element:b[0],move:function(a,b){return c.$apply(function(){return"function"===typeof k.move?k.move(a,b):void 0})},up:function(a,b,g){return c.$apply(function(){return"function"===
typeof k.up?k.up(a,b,g):void 0})},out:function(a,b){return c.$apply(function(){return"function"===typeof k.out?k.out(a,b):void 0})}}};this.draggable=function(b,c){var d,e,f,h;null==c&&(c={});e=[];if("mirror"===c.mode)for(f=0,h=b.length;f<h;f++)d=b[f],d=a.dragMirrorMode($(d),c.defer,c.object),e.push(d.id),a.data.draggables[d.id]=d;else for(f=0,h=b.length;f<h;f++)d=b[f],d=a.dragDragMode($(d),c.defer,c.object),e.push(d.id),a.data.draggables[d.id]=d;return e};this.droppable=function(b,c){var d,e,f,h;
null==c&&(c={});e=[];f=0;for(h=b.length;f<h;f++)d=b[f],d=a.dropMode($(d),c),e.push(d),a.data.droppables[d.id]=d;return e};this.get=function(a){this.setupEasing();this.setupProviders(a);return{isMouseMoved:this.isMouseMoved,data:this.data,draggable:this.draggable,droppable:this.droppable}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);(function(){angular.module("builder",["builder.directive"])}).call(this);
(function(){var f=[].indexOf||function(c){for(var b=0,a=this.length;b<a;b++)if(b in this&&this[b]===c)return b;return-1};angular.module("builder.provider",[]).provider("$builder",function(){var c=this;this.components={};this.groups=[];this.broadcastChannel={updateInput:"$updateInput"};this.forms={"default":[]};this.formsId={"default":0};this.setupProviders=function(b){return b};this.convertComponent=function(b,a){var c,f,d,e,r,h,l,q,n,m,t;c={name:b,group:null!=(f=a.group)?f:"Default",label:null!=
(d=a.label)?d:"",description:null!=(e=a.description)?e:"",placeholder:null!=(r=a.placeholder)?r:"",editable:null!=(h=a.editable)?h:!0,required:null!=(l=a.required)?l:!1,validation:null!=(q=a.validation)?q:"/.*/",errorMessage:null!=(n=a.errorMessage)?n:"",options:null!=(m=a.options)?m:[],arrayToText:null!=(t=a.arrayToText)?t:!1,template:a.template,popoverTemplate:a.popoverTemplate};c.template||console.error("template is empty");c.popoverTemplate||console.error("popoverTemplate is empty");return c};
this.convertFormObject=function(b,a){var c,f,d,e,r,h,l,q,n,m,t,s,u,v,p,w;null==a&&(a={});c=this.components[a.component];null==c&&console.error("component "+a.component+" was not registered.");if(a.id){f=!1;h=this.forms[b];e=0;for(r=h.length;e<r;e++)if(d=h[e],a.id<=d.id){a.id=this.formsId[b]++;f=!0;break}f||(this.formsId[b]=a.id+1)}return{id:null!=(l=a.id)?l:this.formsId[b]++,component:a.component,editable:null!=(n=a.editable)?n:c.editable,index:null!=(m=a.index)?m:0,label:null!=(t=a.label)?t:c.label,
description:null!=(s=a.description)?s:c.description,placeholder:null!=(u=a.placeholder)?u:c.placeholder,options:null!=(v=a.options)?v:c.options,required:null!=(p=a.required)?p:c.required,validation:null!=(w=a.validation)?w:c.validation,errorMessage:null!=(q=a.errorMessage)?q:c.errorMessage}};this.reIndexFormObject=function(b){var a,g,f;b=c.forms[b];a=g=0;for(f=b.length-1;g<=f;a=g+=1)b[a].index=a};this.registerComponent=function(b,a){var g,k;null==a&&(a={});null==c.components[b]?(g=c.convertComponent(b,
a),c.components[b]=g,(k=g.group,0>f.call(c.groups,k))&&c.groups.push(g.group)):console.error("The component "+b+" was registered.")};this.addFormObject=function(b,a){var g,f;null==a&&(a={});null==(g=c.forms)[b]&&(g[b]=[]);null==(f=c.formsId)[b]&&(f[b]=0);return c.insertFormObject(b,c.forms[b].length,a)};this.insertFormObject=function(b,a,f){var k,d;null==f&&(f={});null==(k=c.forms)[b]&&(k[b]=[]);null==(d=c.formsId)[b]&&(d[b]=0);a>c.forms.length?a=c.forms.length:0>a&&(a=0);c.forms[b].splice(a,0,c.convertFormObject(b,
f));return c.reIndexFormObject(b)};this.removeFormObject=function(b,a){c.forms[b].splice(a,1);return c.reIndexFormObject(b)};this.updateFormObjectIndex=function(b,a,f){var k;if(a!==f)return k=c.forms[b],a=k.splice(a,1)[0],k.splice(f,0,a),c.reIndexFormObject(b)};this.get=function(b){this.setupProviders(b);return{components:this.components,groups:this.groups,forms:this.forms,broadcastChannel:this.broadcastChannel,registerComponent:this.registerComponent,addFormObject:this.addFormObject,insertFormObject:this.insertFormObject,
removeFormObject:this.removeFormObject,updateFormObjectIndex:this.updateFormObjectIndex}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);
