(function(){var l,b,c;l=angular.module("builder.controller",["builder.provider"]);b=function(a,d){var e,g;for(e in a)g=a[e],"$$hashKey"!==e&&(d[e]=g)};c=function(a){a.setupScope=function(d){b(d,a);a.optionsText=d.options.join("\n");a.$watch("[label, description, placeholder, required, options]",function(){d.label=a.label;d.description=a.description;d.placeholder=a.placeholder;d.required=a.required;return d.options=a.options},!0);return a.$watch("optionsText",function(d){var g,c,f,h;f=d.split("\n");
h=[];g=0;for(c=f.length;g<c;g++)d=f[g],0<d.length&&h.push(d);a.options=h;return a.inputText=a.options[0]})};return a.data={model:null,backup:function(){return this.model={label:a.label,description:a.description,placeholder:a.placeholder,required:a.required,optionsText:a.optionsText}},rollback:function(){if(this.model)return a.label=this.model.label,a.description=this.model.description,a.placeholder=this.model.placeholder,a.required=this.model.required,a.optionsText=this.model.optionsText}}};c.$inject=
["$scope"];l.controller("fbFormObjectEditableController",c);c=function(a,d){var e;e=d.get("$builder");a.selectGroup=function(d,c){var f,h,b,p;null!=d&&d.preventDefault();a.activeGroup=c;a.components=[];b=e.components;p=[];for(h in b)f=b[h],f.group===c&&p.push(a.components.push(f));return p};a.groups=e.groups;a.activeGroup=a.groups[0];a.allComponents=e.components;return a.$watch("allComponents",function(){return a.selectGroup(null,a.activeGroup)})};c.$inject=["$scope","$injector"];l.controller("fbComponentsController",
c);c=function(a){return a.copyObjectToScope=function(d){return b(d,a)}};c.$inject=["$scope"];l.controller("fbComponentController",c);c=function(a,d){var e,g;e=d.get("$builder");g=d.get("$timeout");return a.$watch("form",function(){a.input.length>a.form.length&&a.input.splice(a.form.length);return g(function(){return a.$broadcast(e.broadcastChannel.updateInput)})},!0)};c.$inject=["$scope","$injector"];l.controller("fbFormController",c);c=function(a,d){d.get("$builder");a.copyObjectToScope=function(d){return b(d,
a)};return a.updateInput=function(d){return a.$parent.input.splice(a.$index,1,{id:a.formObject.id,label:a.formObject.label,value:null!=d?d:""})}};c.$inject=["$scope","$injector"];l.controller("fbFormObjectController",c)}).call(this);
(function(){var l,b;l=angular.module("builder.directive",["builder.provider","builder.controller","builder.drag","validator"]);b=function(c){return{restrict:"A",template:"<div class='form-horizontal'>\n    <div class='fb-form-object-editable' ng-repeat=\"object in formObjects\"\n        fb-form-object-editable=\"object\"></div>\n</div>",link:function(a,d,e){var g,k,f,h,b;g=c.get("$builder");k=c.get("$drag");a.formName=e.fbBuilder;null==(h=g.forms)[b=a.formName]&&(h[b]=[]);a.formObjects=g.forms[a.formName];
f=!0;$(d).addClass("fb-builder");return k.droppable($(d),{move:function(e){var g,c,k,h,b,m;f&&($("div.fb-form-object-editable").popover("hide"),f=!1);c=$(d).find(".fb-form-object-editable:not(.empty,.dragging)");if(0===c.length)0===$(d).find(".fb-form-object-editable.empty").length&&$(d).find(">div:first").append($("<div class='fb-form-object-editable empty'></div>"));else{h=[];h.push(-1E3);k=b=0;for(m=c.length-1;b<=m;k=b+=1)g=$(c[k]),k=g.offset(),g=g.height(),h.push(k.top+g/2);h.push(h[h.length-
1]+1E3);b=-1;for(k=m=a.formObjects.length-1;0<=m;k=m+=-1)if(!a.formObjects[k].editable){b=k;break}k=b=0<=b?b+2:1;for(m=h.length-1;b<=m;k=b+=1)if(e.pageY>h[k-1]&&e.pageY<=h[k]){$(d).find(".empty").remove();e=$("<div class='fb-form-object-editable empty'></div>");k-1<c.length?e.insertBefore($(c[k-1])):e.insertAfter($(c[k-2]));break}}},out:function(){f&&($("div.fb-form-object-editable").popover("hide"),f=!1);return $(d).find(".empty").remove()},up:function(c,b,h){f=!0;if(k.isMouseMoved())return b||"drag"!==
h.mode?b&&("mirror"===h.mode&&g.insertFormObject(a.formName,$(d).find(".empty").index(".fb-form-object-editable"),{component:h.object.componentName}),"drag"===h.mode&&(b=h.object.formObject.index,c=$(d).find(".empty").index(".fb-form-object-editable"),b<c&&c--,g.updateFormObjectIndex(a.formName,b,c))):(c=h.object.formObject,g.removeFormObject(e.fbBuilder,c.index)),$(d).find(".empty").remove();$(d).find(".empty").remove()}})}}};b.$inject=["$injector"];l.directive("fbBuilder",b);b=function(c){return{restrict:"A",
controller:"fbFormObjectEditableController",link:function(a,d,e){var g,k,b,h,m,p,n,q;h=c.get("$builder");p=c.get("$drag");b=c.get("$parse");m=c.get("$compile");n=c.get("$validator");b=b(e.fbFormObjectEditable)(a);e=h.components[b.component];a.setupScope(b);q=m(e.template)(a);$(d).append(q);$(d).on("click",function(){return!1});if(b.editable)return p.draggable($(d),{object:{formObject:b}}),g="fb-"+Math.random().toString().substr(2),k=!1,b=null,b=e.popoverTemplate,b=$(b).addClass(g),a.popover={save:function(e){e.preventDefault();
n.validate(a).success(function(){k=!0;return $(d).popover("hide")})},remove:function(e){e.preventDefault();h.removeFormObject(a.formName,a.$index);$(d).popover("hide")},shown:function(){a.data.backup();return k=!1},cancel:function(e){a.data.rollback();e&&(e.preventDefault(),$(d).popover("hide"))}},b=m(b)(a),$(d).addClass(g),$(d).popover({html:!0,title:e.label,content:b,container:"body"}),$(d).on("show.bs.popover",function(){var a,e;if(p.isMouseMoved())return!1;$("div.fb-form-object-editable:not(."+
g+")").popover("hide");a=$("form."+g).closest(".popover");if(0<a.length)return e=$(d).offset().top+$(d).height()/2,e-=a.height()/2,a.css({position:"absolute",top:e}),a.show(),setTimeout(function(){a.addClass("in");return $(d).triggerHandler("shown.bs.popover")},0),!1}),$(d).on("shown.bs.popover",function(){$(".popover ."+g+" input:first").select();a.$apply(function(){return a.popover.shown()})}),$(d).on("hide.bs.popover",function(){var d;d=$("form."+g).closest(".popover");k||(a.$$phase?a.popover.cancel():
a.$apply(function(){return a.popover.cancel()}));d.removeClass("in");setTimeout(function(){return d.hide()},300);return!1})}}};b.$inject=["$injector"];l.directive("fbFormObjectEditable",b);l.directive("fbComponents",function(){return{restrict:"A",template:'<ul ng-if="groups.length > 1" class="nav nav-tabs nav-justified">\n    <li ng-repeat="group in groups" ng-class="{active:activeGroup==group}">\n        <a href=\'#\' ng-click="selectGroup($event, group)">{{group}}</a>\n    </li>\n</ul>\n<div class=\'form-horizontal\'>\n    <div class=\'fb-component\' ng-repeat="component in components"\n        fb-component="component"></div>\n</div>',
controller:"fbComponentsController"}});b=function(c){return{restrict:"A",controller:"fbComponentController",link:function(a,d,e){var g,b,f;c.get("$builder");b=c.get("$drag");f=c.get("$parse");g=c.get("$compile");e=f(e.fbComponent)(a);a.copyObjectToScope(e);b.draggable($(d),{mode:"mirror",defer:!1,object:{componentName:e.name}});a=g(e.template)(a);return $(d).append(a)}}};b.$inject=["$injector"];l.directive("fbComponent",b);b=function(c){return{restrict:"A",require:"ngModel",scope:{input:"=ngModel"},
template:'<div class=\'fb-form-object\' ng-repeat="object in form" fb-form-object="object">\n</div>',controller:"fbFormController",link:function(a,d,e){d=c.get("$builder");a.formName=e.fbForm;return a.form=d.forms[a.formName]}}};b.$inject=["$injector"];l.directive("fbForm",b);b=function(c){return{restrict:"A",controller:"fbFormObjectController",link:function(a,d,e){var b,k,f;b=c.get("$builder");k=c.get("$compile");f=c.get("$parse");a.formObject=f(e.fbFormObject)(a);f=b.components[a.formObject.component];
a.$on(b.broadcastChannel.updateInput,function(){return a.updateInput(a.inputText)});f.arrayToText&&(a.inputArray=[],a.$watch("inputArray",function(d,e){var c,b;if(d!==e){c=[];for(b in a.inputArray)a.inputArray[b]&&c.push(a.options[b]);return a.inputText=c.join(", ")}},!0));a.$watch("inputText",function(){return a.updateInput(a.inputText)});a.$watch(e.fbFormObject,function(){return a.copyObjectToScope(a.formObject)},!0);e=$(f.template);e.find("[ng-model='inputText']").attr({validator:"{{validation}}",
"validator-error":"{{errorMessage}}"});k=k(e)(a);$(d).append(k);if(!f.arrayToText&&0<a.formObject.options.length)return a.inputText=a.formObject.options[0]}}};b.$inject=["$injector"];l.directive("fbFormObject",b)}).call(this);
(function(){angular.module("builder.drag",[]).provider("$drag",function(){var l,b,c,a=this;b=l=null;this.data={draggables:{},droppables:{}};this.mouseMoved=!1;this.isMouseMoved=function(){return a.mouseMoved};this.hooks={down:{},move:{},up:{}};this.eventMouseMove=function(){};this.eventMouseUp=function(){};$(function(){$(document).on("mousedown",function(d){var e,c,b;a.mouseMoved=!1;b=a.hooks.down;for(c in b)e=b[c],e(d)});$(document).on("mousemove",function(d){var e,c,b;a.mouseMoved=!0;b=a.hooks.move;
for(c in b)e=b[c],e(d)});return $(document).on("mouseup",function(d){var e,c,b;b=a.hooks.up;for(c in b)e=b[c],e(d)})});this.currentId=0;this.getNewId=function(){return""+a.currentId++};this.setupEasing=function(){return jQuery.extend(jQuery.easing,{easeOutQuad:function(a,e,c,b,f){return-b*(e/=f)*(e-2)+c}})};this.setupProviders=function(a){l=a;return b=l.get("$rootScope")};this.isHover=function(a,e){var c,b,f,h,m,p,n;p=a.offset();n=e.offset();f=a.width();h=a.height();c=e.width();b=e.height();m={x:!1,
y:!1};m.x=p.left>n.left&&p.left<n.left+c;m.x=m.x||p.left+f>n.left&&p.left+f<n.left+c;if(!m)return!1;m.y=p.top>n.top&&p.top<n.top+b;m.y=m.y||p.top+h>n.top&&p.top+h<n.top+b;return m.x&&m.y};c=function(a,e){return setTimeout(function(){return e()},a)};this.autoScroll={up:!1,down:!1,scrolling:!1,scroll:function(){a.autoScroll.scrolling=!0;return a.autoScroll.up?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()-50},100,"easeOutQuad"),c(100,function(){return a.autoScroll.scroll()})):a.autoScroll.down?
($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()+50},100,"easeOutQuad"),c(100,function(){return a.autoScroll.scroll()})):a.autoScroll.scrolling=!1},start:function(d){if(50>d.clientY){if(a.autoScroll.up=!0,a.autoScroll.down=!1,!a.autoScroll.scrolling)return a.autoScroll.scroll()}else if(d.clientY>$(window).innerHeight()-50){if(a.autoScroll.up=!1,a.autoScroll.down=!0,!a.autoScroll.scrolling)return a.autoScroll.scroll()}else return a.autoScroll.up=!1,a.autoScroll.down=!1}};this.dragMirrorMode=
function(d,e,c){var b;null==e&&(e=!0);b={id:a.getNewId(),mode:"mirror",maternal:d[0],element:null,object:c};d.on("mousedown",function(c){var h;c.preventDefault();h=d.clone();b.element=h[0];h.addClass("fb-draggable form-horizontal prepare-dragging");a.hooks.move.drag=function(c,e){var g,f,l,r;if(h.hasClass("prepare-dragging")&&(h.css({width:d.width(),height:d.height()}),h.removeClass("prepare-dragging"),h.addClass("dragging"),e))return;h.offset({left:c.pageX-h.width()/2,top:c.pageY-h.height()/2});
a.autoScroll.start(c);l=a.data.droppables;r=[];for(f in l)g=l[f],a.isHover(h,$(g.element))?r.push(g.move(c,b)):r.push(g.out(c,b));return r};a.hooks.up.drag=function(d){var c,e,g,f;f=a.data.droppables;for(e in f)c=f[e],g=a.isHover(h,$(c.element)),c.up(d,g,b);delete a.hooks.move.drag;delete a.hooks.up.drag;b.element=null;return h.remove()};$("body").append(h);if(!e)return a.hooks.move.drag(c,e)});return b};this.dragDragMode=function(d,c,b){var k;null==c&&(c=!0);k={id:a.getNewId(),mode:"drag",maternal:null,
element:d[0],object:b};d.addClass("fb-draggable");d.on("mousedown",function(b){b.preventDefault();if(!d.hasClass("dragging")&&(d.addClass("prepare-dragging"),a.hooks.move.drag=function(c,b){var e,g,f;if(d.hasClass("prepare-dragging")&&(d.css({width:d.width(),height:d.height()}),d.removeClass("prepare-dragging"),d.addClass("dragging"),b))return;d.offset({left:c.pageX-d.width()/2,top:c.pageY-d.height()/2});a.autoScroll.start(c);f=a.data.droppables;for(g in f)e=f[g],a.isHover(d,$(e.element))?e.move(c,
k):e.out(c,k)},a.hooks.up.drag=function(c){var b,e,g,f;f=a.data.droppables;for(e in f)b=f[e],g=a.isHover(d,$(b.element)),b.up(c,g,k);delete a.hooks.move.drag;delete a.hooks.up.drag;d.css({width:"",height:"",left:"",top:""});return d.removeClass("dragging defer-dragging")},!c))return a.hooks.move.drag(b,c)});return k};this.dropMode=function(d,c){return{id:a.getNewId(),element:d[0],move:function(a,d){return b.$apply(function(){return"function"===typeof c.move?c.move(a,d):void 0})},up:function(a,d,f){return b.$apply(function(){return"function"===
typeof c.up?c.up(a,d,f):void 0})},out:function(a,d){return b.$apply(function(){return"function"===typeof c.out?c.out(a,d):void 0})}}};this.draggable=function(d,c){var b,k,f,h;null==c&&(c={});k=[];if("mirror"===c.mode)for(f=0,h=d.length;f<h;f++)b=d[f],b=a.dragMirrorMode($(b),c.defer,c.object),k.push(b.id),a.data.draggables[b.id]=b;else for(f=0,h=d.length;f<h;f++)b=d[f],b=a.dragDragMode($(b),c.defer,c.object),k.push(b.id),a.data.draggables[b.id]=b;return k};this.droppable=function(c,b){var g,k,f,h;
null==b&&(b={});k=[];f=0;for(h=c.length;f<h;f++)g=c[f],g=a.dropMode($(g),b),k.push(g),a.data.droppables[g.id]=g;return k};this.get=function(a){this.setupEasing();this.setupProviders(a);return{isMouseMoved:this.isMouseMoved,data:this.data,draggable:this.draggable,droppable:this.droppable}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);(function(){angular.module("builder",["builder.directive"])}).call(this);
(function(){var l=[].indexOf||function(b){for(var c=0,a=this.length;c<a;c++)if(c in this&&this[c]===b)return c;return-1};angular.module("builder.provider",[]).provider("$builder",function(){var b=this;this.components={};this.groups=[];this.broadcastChannel={updateInput:"$updateInput"};this.forms={"default":[]};this.formsId={"default":0};this.convertComponent=function(c,a){var b,e,g,k,f,h,m,l,n,q,s;b={name:c,group:null!=(e=a.group)?e:"Default",label:null!=(g=a.label)?g:"",description:null!=(k=a.description)?
k:"",placeholder:null!=(f=a.placeholder)?f:"",editable:null!=(h=a.editable)?h:!0,required:null!=(m=a.required)?m:!1,validation:null!=(l=a.validation)?l:"/.*/",errorMessage:null!=(n=a.errorMessage)?n:"",options:null!=(q=a.options)?q:[],arrayToText:null!=(s=a.arrayToText)?s:!1,template:a.template,popoverTemplate:a.popoverTemplate};b.template||console.error("The template is empty.");b.popoverTemplate||console.error("The popoverTemplate is empty.");return b};this.convertFormObject=function(c,a){var b,
e,g,k,f,h,m,l,n,q,s,r,t,u,v,w;null==a&&(a={});b=this.components[a.component];if(null==b)throw"The component "+a.component+" was not registered.";if(a.id){e=!1;h=this.forms[c];k=0;for(f=h.length;k<f;k++)if(g=h[k],a.id<=g.id){a.id=this.formsId[c]++;e=!0;break}e||(this.formsId[c]=a.id+1)}return{id:null!=(m=a.id)?m:this.formsId[c]++,component:a.component,editable:null!=(n=a.editable)?n:b.editable,index:null!=(q=a.index)?q:0,label:null!=(s=a.label)?s:b.label,description:null!=(r=a.description)?r:b.description,
placeholder:null!=(t=a.placeholder)?t:b.placeholder,options:null!=(u=a.options)?u:b.options,required:null!=(v=a.required)?v:b.required,validation:null!=(w=a.validation)?w:b.validation,errorMessage:null!=(l=a.errorMessage)?l:b.errorMessage}};this.reindexFormObject=function(c){var a,d,e;c=b.forms[c];a=d=0;for(e=c.length-1;d<=e;a=d+=1)c[a].index=a};this.registerComponent=function(c,a){var d,e;null==a&&(a={});null==b.components[c]?(d=b.convertComponent(c,a),b.components[c]=d,(e=d.group,0>l.call(b.groups,
e))&&b.groups.push(d.group)):console.error("The component "+c+" was registered.")};this.addFormObject=function(c,a){null==a&&(a={});return b.insertFormObject(c,b.forms[c].length,a)};this.insertFormObject=function(c,a,d){var e,g;null==d&&(d={});null==(e=b.forms)[c]&&(e[c]=[]);null==(g=b.formsId)[c]&&(g[c]=0);a>b.forms.length?a=b.forms.length:0>a&&(a=0);b.forms[c].splice(a,0,b.convertFormObject(c,d));return b.reindexFormObject(c)};this.removeFormObject=function(c,a){b.forms[c].splice(a,1);return b.reindexFormObject(c)};
this.updateFormObjectIndex=function(c,a,d){var e;if(a!==d)return e=b.forms[c],a=e.splice(a,1)[0],e.splice(d,0,a),b.reindexFormObject(c)};this.$get=this.get=function(){return{components:this.components,groups:this.groups,forms:this.forms,broadcastChannel:this.broadcastChannel,registerComponent:this.registerComponent,addFormObject:this.addFormObject,insertFormObject:this.insertFormObject,removeFormObject:this.removeFormObject,updateFormObjectIndex:this.updateFormObjectIndex}}})}).call(this);
