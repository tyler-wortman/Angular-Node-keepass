(function(){var m,c,b;m=angular.module("builder.controller",["builder.provider"]);c=function(a,e){var b,d;for(b in a)d=a[b],"$$hashKey"!==b&&(e[b]=d)};b=function(a,e){var b;b=e.get("$builder");a.setupScope=function(e){c(e,a);a.optionsText=e.options.join("\n");a.$watch("[label, description, placeholder, required, options, validation]",function(){e.label=a.label;e.description=a.description;e.placeholder=a.placeholder;e.required=a.required;e.options=a.options;return e.validation=a.validation},!0);a.$watch("optionsText",
function(e){var b,f,d,c;d=e.split("\n");c=[];b=0;for(f=d.length;b<f;b++)e=d[b],0<e.length&&c.push(e);a.options=c;return a.inputText=a.options[0]});return a.validationOptions=b.components[e.component].validationOptions};return a.data={model:null,backup:function(){return this.model={label:a.label,description:a.description,placeholder:a.placeholder,required:a.required,optionsText:a.optionsText,validation:a.validation}},rollback:function(){if(this.model)return a.label=this.model.label,a.description=this.model.description,
a.placeholder=this.model.placeholder,a.required=this.model.required,a.optionsText=this.model.optionsText,a.validation=this.model.validation}}};b.$inject=["$scope","$injector"];m.controller("fbFormObjectEditableController",b);b=function(a,e){var b;b=e.get("$builder");a.selectGroup=function(e,g){var k,c,l,p;null!=e&&e.preventDefault();a.activeGroup=g;a.components=[];l=b.components;p=[];for(c in l)k=l[c],k.group===g&&p.push(a.components.push(k));return p};a.groups=b.groups;a.activeGroup=a.groups[0];
a.allComponents=b.components;return a.$watch("allComponents",function(){return a.selectGroup(null,a.activeGroup)})};b.$inject=["$scope","$injector"];m.controller("fbComponentsController",b);b=function(a){return a.copyObjectToScope=function(e){return c(e,a)}};b.$inject=["$scope"];m.controller("fbComponentController",b);b=function(a,e){var b,d;b=e.get("$builder");d=e.get("$timeout");null==a.input&&(a.input=[]);return a.$watch("form",function(){a.input.length>a.form.length&&a.input.splice(a.form.length);
return d(function(){return a.$broadcast(b.broadcastChannel.updateInput)})},!0)};b.$inject=["$scope","$injector"];m.controller("fbFormController",b);b=function(a,e){e.get("$builder");a.copyObjectToScope=function(e){return c(e,a)};return a.updateInput=function(e){return a.$parent.input.splice(a.$index,1,{id:a.formObject.id,label:a.formObject.label,value:null!=e?e:""})}};b.$inject=["$scope","$injector"];m.controller("fbFormObjectController",b)}).call(this);
(function(){var m,c;m=angular.module("builder.directive",["builder.provider","builder.controller","builder.drag","validator"]);c=function(b){return{restrict:"A",template:"<div class='form-horizontal'>\n    <div class='fb-form-object-editable' ng-repeat=\"object in formObjects\"\n        fb-form-object-editable=\"object\"></div>\n</div>",link:function(a,e,f){var d,g,c,h,l;d=b.get("$builder");g=b.get("$drag");a.formName=f.fbBuilder;null==(h=d.forms)[l=a.formName]&&(h[l]=[]);a.formObjects=d.forms[a.formName];
c=!0;$(e).addClass("fb-builder");return g.droppable($(e),{move:function(a){var b,f,d,g,h,l;c&&($("div.fb-form-object-editable").popover("hide"),c=!1);f=$(e).find(".fb-form-object-editable:not(.empty,.dragging)");if(0===f.length)0===$(e).find(".fb-form-object-editable.empty").length&&$(e).find(">div:first").append($("<div class='fb-form-object-editable empty'></div>"));else{g=[];g.push(-1E3);d=h=0;for(l=f.length;h<l;d=h+=1)b=$(f[d]),d=b.offset(),b=b.height(),g.push(d.top+b/2);g.push(g[g.length-1]+
1E3);d=h=1;for(l=g.length-1;h<=l;d=h+=1)if(a.pageY>g[d-1]&&a.pageY<=g[d]){$(e).find(".empty").remove();a=$("<div class='fb-form-object-editable empty'></div>");d-1<f.length?a.insertBefore($(f[d-1])):a.insertAfter($(f[d-2]));break}}},out:function(){c&&($("div.fb-form-object-editable").popover("hide"),c=!1);return $(e).find(".empty").remove()},up:function(b,h,l){c=!0;if(g.isMouseMoved())return h||"drag"!==l.mode?h&&("mirror"===l.mode&&d.insertFormObject(a.formName,$(e).find(".empty").index(".fb-form-object-editable"),
{component:l.object.componentName}),"drag"===l.mode&&(h=l.object.formObject.index,b=$(e).find(".empty").index(".fb-form-object-editable"),h<b&&b--,d.updateFormObjectIndex(a.formName,h,b))):(b=l.object.formObject,b.editable&&d.removeFormObject(f.fbBuilder,b.index)),$(e).find(".empty").remove();$(e).find(".empty").remove()}})}}};c.$inject=["$injector"];m.directive("fbBuilder",c);c=function(b){return{restrict:"A",controller:"fbFormObjectEditableController",link:function(a,e,f){var d,g,c,h,l,p,n,q;h=
b.get("$builder");p=b.get("$drag");c=b.get("$parse");l=b.get("$compile");n=b.get("$validator");c=c(f.fbFormObjectEditable)(a);f=h.components[c.component];a.setupScope(c);q=l(f.template)(a);$(e).append(q);$(e).on("click",function(){return!1});p.draggable($(e),{object:{formObject:c}});if(c.editable)return d="fb-"+Math.random().toString().substr(2),g=!1,c=null,c=f.popoverTemplate,c=$(c).addClass(d),a.popover={save:function(b){b.preventDefault();n.validate(a).success(function(){g=!0;return $(e).popover("hide")})},
remove:function(b){b.preventDefault();h.removeFormObject(a.formName,a.$index);$(e).popover("hide")},shown:function(){a.data.backup();return g=!1},cancel:function(b){a.data.rollback();b&&(b.preventDefault(),$(e).popover("hide"))}},c=l(c)(a),$(e).addClass(d),$(e).popover({html:!0,title:f.label,content:c,container:"body"}),$(e).on("show.bs.popover",function(){var a,b;if(p.isMouseMoved())return!1;$("div.fb-form-object-editable:not(."+d+")").popover("hide");a=$("form."+d).closest(".popover");if(0<a.length)return b=
$(e).offset().top+$(e).height()/2,b-=a.height()/2,a.css({position:"absolute",top:b}),a.show(),setTimeout(function(){a.addClass("in");return $(e).triggerHandler("shown.bs.popover")},0),!1}),$(e).on("shown.bs.popover",function(){$(".popover ."+d+" input:first").select();a.$apply(function(){return a.popover.shown()})}),$(e).on("hide.bs.popover",function(){var b;b=$("form."+d).closest(".popover");g||(a.$$phase?a.popover.cancel():a.$apply(function(){return a.popover.cancel()}));b.removeClass("in");setTimeout(function(){return b.hide()},
300);return!1})}}};c.$inject=["$injector"];m.directive("fbFormObjectEditable",c);m.directive("fbComponents",function(){return{restrict:"A",template:'<ul ng-if="groups.length > 1" class="nav nav-tabs nav-justified">\n    <li ng-repeat="group in groups" ng-class="{active:activeGroup==group}">\n        <a href=\'#\' ng-click="selectGroup($event, group)">{{group}}</a>\n    </li>\n</ul>\n<div class=\'form-horizontal\'>\n    <div class=\'fb-component\' ng-repeat="component in components"\n        fb-component="component"></div>\n</div>',
controller:"fbComponentsController"}});c=function(b){return{restrict:"A",controller:"fbComponentController",link:function(a,e,f){var d,c,k;b.get("$builder");c=b.get("$drag");k=b.get("$parse");d=b.get("$compile");f=k(f.fbComponent)(a);a.copyObjectToScope(f);c.draggable($(e),{mode:"mirror",defer:!1,object:{componentName:f.name}});a=d(f.template)(a);return $(e).append(a)}}};c.$inject=["$injector"];m.directive("fbComponent",c);c=function(b){return{restrict:"A",require:"ngModel",scope:{input:"=ngModel"},
template:'<div class=\'fb-form-object\' ng-repeat="object in form" fb-form-object="object"></div>',controller:"fbFormController",link:function(a,e,f){e=b.get("$builder");a.formName=f.fbForm;return a.form=e.forms[f.fbForm]}}};c.$inject=["$injector"];m.directive("fbForm",c);c=function(b){return{restrict:"A",controller:"fbFormObjectController",link:function(a,e,f){var d,c,k;d=b.get("$builder");c=b.get("$compile");k=b.get("$parse");a.formObject=k(f.fbFormObject)(a);k=d.components[a.formObject.component];
a.$on(d.broadcastChannel.updateInput,function(){return a.updateInput(a.inputText)});k.arrayToText&&(a.inputArray=[],a.$watch("inputArray",function(b,e){var d,c;if(b!==e){d=[];for(c in a.inputArray)a.inputArray[c]&&d.push(a.options[c]);return a.inputText=d.join(", ")}},!0));a.$watch("inputText",function(){return a.updateInput(a.inputText)});a.$watch(f.fbFormObject,function(){return a.copyObjectToScope(a.formObject)},!0);f=$(k.template);f.find("[ng-model='inputText']").attr({validator:"{{validation}}"});
c=c(f)(a);$(e).append(c);if(!k.arrayToText&&0<a.formObject.options.length)return a.inputText=a.formObject.options[0]}}};c.$inject=["$injector"];m.directive("fbFormObject",c)}).call(this);
(function(){angular.module("builder.drag",[]).provider("$drag",function(){var m,c,b;c=m=null;this.data={draggables:{},droppables:{}};this.mouseMoved=!1;this.isMouseMoved=function(a){return function(){return a.mouseMoved}}(this);this.hooks={down:{},move:{},up:{}};this.eventMouseMove=function(){};this.eventMouseUp=function(){};$(function(a){return function(){$(document).on("mousedown",function(b){var c,d,g;a.mouseMoved=!1;g=a.hooks.down;for(d in g)c=g[d],c(b)});$(document).on("mousemove",function(b){var c,
d,g;a.mouseMoved=!0;g=a.hooks.move;for(d in g)c=g[d],c(b)});return $(document).on("mouseup",function(b){var c,d,g;g=a.hooks.up;for(d in g)c=g[d],c(b)})}}(this));this.currentId=0;this.getNewId=function(a){return function(){return""+a.currentId++}}(this);this.setupEasing=function(){return jQuery.extend(jQuery.easing,{easeOutQuad:function(a,b,c,d,g){return-d*(b/=g)*(b-2)+c}})};this.setupProviders=function(a){m=a;return c=m.get("$rootScope")};this.isHover=function(a){return function(a,b){var c,g,k,h,
l,p,n;p=a.offset();n=b.offset();k=a.width();h=a.height();c=b.width();g=b.height();l={x:!1,y:!1};l.x=p.left>n.left&&p.left<n.left+c;l.x=l.x||p.left+k>n.left&&p.left+k<n.left+c;if(!l)return!1;l.y=p.top>n.top&&p.top<n.top+g;l.y=l.y||p.top+h>n.top&&p.top+h<n.top+g;return l.x&&l.y}}(this);b=function(a,b){return setTimeout(function(){return b()},a)};this.autoScroll={up:!1,down:!1,scrolling:!1,scroll:function(a){return function(){a.autoScroll.scrolling=!0;return a.autoScroll.up?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()-
50},100,"easeOutQuad"),b(100,function(){return a.autoScroll.scroll()})):a.autoScroll.down?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()+50},100,"easeOutQuad"),b(100,function(){return a.autoScroll.scroll()})):a.autoScroll.scrolling=!1}}(this),start:function(a){return function(b){if(50>b.clientY){if(a.autoScroll.up=!0,a.autoScroll.down=!1,!a.autoScroll.scrolling)return a.autoScroll.scroll()}else if(b.clientY>$(window).innerHeight()-50){if(a.autoScroll.up=!1,a.autoScroll.down=!0,
!a.autoScroll.scrolling)return a.autoScroll.scroll()}else return a.autoScroll.up=!1,a.autoScroll.down=!1}}(this),stop:function(a){return function(){a.autoScroll.up=!1;return a.autoScroll.down=!1}}(this)};this.dragMirrorMode=function(a){return function(b,c,d){var g;null==c&&(c=!0);g={id:a.getNewId(),mode:"mirror",maternal:b[0],element:null,object:d};b.on("mousedown",function(d){var h;d.preventDefault();h=b.clone();g.element=h[0];h.addClass("fb-draggable form-horizontal prepare-dragging");a.hooks.move.drag=
function(c,d){var f,k,m,r;if(h.hasClass("prepare-dragging")&&(h.css({width:b.width(),height:b.height()}),h.removeClass("prepare-dragging"),h.addClass("dragging"),d))return;h.offset({left:c.pageX-h.width()/2,top:c.pageY-h.height()/2});a.autoScroll.start(c);m=a.data.droppables;r=[];for(k in m)f=m[k],a.isHover(h,$(f.element))?r.push(f.move(c,g)):r.push(f.out(c,g));return r};a.hooks.up.drag=function(b){var c,e,d,f;f=a.data.droppables;for(e in f)c=f[e],d=a.isHover(h,$(c.element)),c.up(b,d,g);delete a.hooks.move.drag;
delete a.hooks.up.drag;g.element=null;h.remove();return a.autoScroll.stop()};$("body").append(h);if(!c)return a.hooks.move.drag(d,c)});return g}}(this);this.dragDragMode=function(a){return function(b,c,d){var g;null==c&&(c=!0);g={id:a.getNewId(),mode:"drag",maternal:null,element:b[0],object:d};b.addClass("fb-draggable");b.on("mousedown",function(d){d.preventDefault();if(!b.hasClass("dragging")&&(b.addClass("prepare-dragging"),a.hooks.move.drag=function(c,d){var f,k,m;if(b.hasClass("prepare-dragging")&&
(b.css({width:b.width(),height:b.height()}),b.removeClass("prepare-dragging"),b.addClass("dragging"),d))return;b.offset({left:c.pageX-b.width()/2,top:c.pageY-b.height()/2});a.autoScroll.start(c);m=a.data.droppables;for(k in m)f=m[k],a.isHover(b,$(f.element))?f.move(c,g):f.out(c,g)},a.hooks.up.drag=function(c){var d,f,k,m;m=a.data.droppables;for(f in m)d=m[f],k=a.isHover(b,$(d.element)),d.up(c,k,g);delete a.hooks.move.drag;delete a.hooks.up.drag;b.css({width:"",height:"",left:"",top:""});b.removeClass("dragging defer-dragging");
return a.autoScroll.stop()},!c))return a.hooks.move.drag(d,c)});return g}}(this);this.dropMode=function(a){return function(b,f){return{id:a.getNewId(),element:b[0],move:function(a,b){return c.$apply(function(){return"function"===typeof f.move?f.move(a,b):void 0})},up:function(a,b,e){return c.$apply(function(){return"function"===typeof f.up?f.up(a,b,e):void 0})},out:function(a,b){return c.$apply(function(){return"function"===typeof f.out?f.out(a,b):void 0})}}}}(this);this.draggable=function(a){return function(b,
c){var d,g,k,h;null==c&&(c={});g=[];if("mirror"===c.mode)for(k=0,h=b.length;k<h;k++)d=b[k],d=a.dragMirrorMode($(d),c.defer,c.object),g.push(d.id),a.data.draggables[d.id]=d;else for(k=0,h=b.length;k<h;k++)d=b[k],d=a.dragDragMode($(d),c.defer,c.object),g.push(d.id),a.data.draggables[d.id]=d;return g}}(this);this.droppable=function(a){return function(b,c){var d,g,k,h;null==c&&(c={});g=[];k=0;for(h=b.length;k<h;k++)d=b[k],d=a.dropMode($(d),c),g.push(d),a.data.droppables[d.id]=d;return g}}(this);this.get=
function(a){this.setupEasing();this.setupProviders(a);return{isMouseMoved:this.isMouseMoved,data:this.data,draggable:this.draggable,droppable:this.droppable}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);(function(){angular.module("builder",["builder.directive"])}).call(this);
(function(){var m=[].indexOf||function(c){for(var b=0,a=this.length;b<a;b++)if(b in this&&this[b]===c)return b;return-1};angular.module("builder.provider",[]).provider("$builder",function(){this.version="0.0.1";this.components={};this.groups=[];this.broadcastChannel={updateInput:"$updateInput"};this.forms={"default":[]};this.formsId={"default":0};this.convertComponent=function(c,b){var a,e,f,d,g,k,h,l,m,n,q;a={name:c,group:null!=(e=b.group)?e:"Default",label:null!=(f=b.label)?f:"",description:null!=
(d=b.description)?d:"",placeholder:null!=(g=b.placeholder)?g:"",editable:null!=(k=b.editable)?k:!0,required:null!=(h=b.required)?h:!1,validation:null!=(l=b.validation)?l:"/.*/",validationOptions:null!=(m=b.validationOptions)?m:[],options:null!=(n=b.options)?n:[],arrayToText:null!=(q=b.arrayToText)?q:!1,template:b.template,popoverTemplate:b.popoverTemplate};a.template||console.error("The template is empty.");a.popoverTemplate||console.error("The popoverTemplate is empty.");return a};this.convertFormObject=
function(c,b){var a,e,f,d,g,k,h,l,m,n,q,s,r,t,u;null==b&&(b={});a=this.components[b.component];if(null==a)throw"The component "+b.component+" was not registered.";if(b.id){e=!1;k=this.forms[c];d=0;for(g=k.length;d<g;d++)if(f=k[d],b.id<=f.id){b.id=this.formsId[c]++;e=!0;break}e||(this.formsId[c]=b.id+1)}return{id:null!=(h=b.id)?h:this.formsId[c]++,component:b.component,editable:null!=(l=b.editable)?l:a.editable,index:null!=(m=b.index)?m:0,label:null!=(n=b.label)?n:a.label,description:null!=(q=b.description)?
q:a.description,placeholder:null!=(s=b.placeholder)?s:a.placeholder,options:null!=(r=b.options)?r:a.options,required:null!=(t=b.required)?t:a.required,validation:null!=(u=b.validation)?u:a.validation}};this.reindexFormObject=function(c){return function(b){var a,e,f;b=c.forms[b];a=e=0;for(f=b.length;e<f;a=e+=1)b[a].index=a}}(this);this.registerComponent=function(c){return function(b,a){var e,f;null==a&&(a={});null==c.components[b]?(e=c.convertComponent(b,a),c.components[b]=e,(f=e.group,0>m.call(c.groups,
f))&&c.groups.push(e.group)):console.error("The component "+b+" was registered.")}}(this);this.addFormObject=function(c){return function(b,a){var e;null==a&&(a={});null==(e=c.forms)[b]&&(e[b]=[]);return c.insertFormObject(b,c.forms[b].length,a)}}(this);this.insertFormObject=function(c){return function(b,a,e){var f,d;null==e&&(e={});null==(f=c.forms)[b]&&(f[b]=[]);null==(d=c.formsId)[b]&&(d[b]=0);a>c.forms[b].length?a=c.forms[b].length:0>a&&(a=0);c.forms[b].splice(a,0,c.convertFormObject(b,e));return c.reindexFormObject(b)}}(this);
this.removeFormObject=function(c){return function(b,a){c.forms[b].splice(a,1);return c.reindexFormObject(b)}}(this);this.updateFormObjectIndex=function(c){return function(b,a,e){var f;if(a!==e)return f=c.forms[b],a=f.splice(a,1)[0],f.splice(e,0,a),c.reindexFormObject(b)}}(this);this.$get=this.get=function(){return{version:this.version,components:this.components,groups:this.groups,forms:this.forms,broadcastChannel:this.broadcastChannel,registerComponent:this.registerComponent,addFormObject:this.addFormObject,
insertFormObject:this.insertFormObject,removeFormObject:this.removeFormObject,updateFormObjectIndex:this.updateFormObjectIndex}}})}).call(this);
