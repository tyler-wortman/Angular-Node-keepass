(function(){var h,c;h=angular.module("builder.controller",["builder.provider"]);c=function(b){b.setupScope=function(a){var g,d;for(g in a)d=a[g],"$$hashKey"!==g&&(b[g]=d);b.optionsText=a.options.join("\n");b.$watch("[label, description, placeholder, required, options]",function(){a.label=b.label;a.description=b.description;a.placeholder=b.placeholder;a.required=b.required;return a.options=b.options},!0);return b.$watch("optionsText",function(a){var g,d,c,l;c=a.split("\n");l=[];g=0;for(d=c.length;g<
d;g++)a=c[g],0<a.length&&l.push(a);b.options=l;return b.inputText=b.options[0]})};return b.data={model:null,backup:function(){return this.model={label:b.label,description:b.description,placeholder:b.placeholder,required:b.required,optionsText:b.optionsText}},rollback:function(){if(this.model)return b.label=this.model.label,b.description=this.model.description,b.placeholder=this.model.placeholder,b.required=this.model.required,b.optionsText=this.model.optionsText}}};c.$inject=["$scope"];h.controller("fbFormObjectEditableController",
c);c=function(b,a){var g;g=a.get("$builder");b.selectGroup=function(a,e){var f,m,c,l;null!=a&&a.preventDefault();b.activeGroup=e;b.components=[];c=g.components;l=[];for(m in c)f=c[m],f.group===e&&l.push(b.components.push(f));return l};b.groups=g.groups;b.activeGroup=b.groups[0];b.allComponents=g.components;return b.$watch("allComponents",function(){return b.selectGroup(null,b.activeGroup)})};c.$inject=["$scope","$injector"];h.controller("fbComponentsController",c);c=function(b){return b.copyObjectToScope=
function(a){var g,d,e;e=[];for(g in a)d=a[g],"$$hashKey"!==g&&e.push(b[g]=d);return e}};c.$inject=["$scope"];h.controller("fbComponentController",c);c=function(b,a){var g,d;g=a.get("$builder");d=a.get("$timeout");return b.$watch("form",function(){b.input.length>b.form.length&&b.input.splice(b.form.length);return d(function(){return b.$broadcast(g.broadcastChannel.updateInput)})},!0)};c.$inject=["$scope","$injector"];h.controller("fbFormController",c);c=function(b,a){a.get("$builder");b.copyObjectToScope=
function(a){var d,e,f;f=[];for(d in a)e=a[d],"$$hashKey"!==d&&f.push(b[d]=e);return f};return b.updateInput=function(a){return b.$parent.input.splice(b.$index,1,{id:b.formObject.id,label:b.formObject.label,value:null!=a?a:""})}};c.$inject=["$scope","$injector"];h.controller("fbFormObjectController",c)}).call(this);
(function(){var h,c;h=angular.module("builder.directive",["builder.provider","builder.controller","builder.drag","validator"]);c=function(b){return{restrict:"A",template:"<div class='form-horizontal'>\n    <div class='fb-form-object-editable' ng-repeat=\"object in formObjects\"\n        fb-form-object-editable=\"object\"></div>\n</div>",link:function(a,g,d){var e,f,c,k,l;e=b.get("$builder");f=b.get("$drag");a.formName=d.fbBuilder;null==(k=e.forms)[l=a.formName]&&(k[l]=[]);a.formObjects=e.forms[a.formName];
c=!0;$(g).addClass("fb-builder");return f.droppable($(g),{move:function(b){var d,e,f,k,l,h;c&&($("div.fb-form-object-editable").popover("hide"),c=!1);e=$(g).find(".fb-form-object-editable:not(.empty,.dragging)");if(0===e.length)0===$(g).find(".fb-form-object-editable.empty").length&&$(g).find(">div:first").append($("<div class='fb-form-object-editable empty'></div>"));else{k=[];k.push(-1E3);f=l=0;for(h=e.length-1;l<=h;f=l+=1)d=$(e[f]),f=d.offset(),d=d.height(),k.push(f.top+d/2);k.push(k[k.length-
1]+1E3);l=-1;for(f=h=a.formObjects.length-1;0<=h;f=h+=-1)if(!a.formObjects[f].editable){l=f;break}f=l=0<=l?l+2:1;for(h=k.length-1;l<=h;f=l+=1)if(b.pageY>k[f-1]&&b.pageY<=k[f]){$(g).find(".empty").remove();b=$("<div class='fb-form-object-editable empty'></div>");f-1<e.length?b.insertBefore($(e[f-1])):b.insertAfter($(e[f-2]));break}}},out:function(){c&&($("div.fb-form-object-editable").popover("hide"),c=!1);return $(g).find(".empty").remove()},up:function(b,k,l){c=!0;if(f.isMouseMoved())return k||"drag"!==
l.mode?k&&("mirror"===l.mode&&e.insertFormObject(a.formName,$(g).find(".empty").index(".fb-form-object-editable"),{component:l.object.componentName}),"drag"===l.mode&&(k=l.object.formObject.index,b=$(g).find(".empty").index(".fb-form-object-editable"),k<b&&b--,e.updateFormObjectIndex(a.formName,k,b))):(b=l.object.formObject,e.removeFormObject(d.fbBuilder,b.index)),$(g).find(".empty").remove();$(g).find(".empty").remove()}})}}};c.$inject=["$injector"];h.directive("fbBuilder",c);c=function(b){return{restrict:"A",
controller:"fbFormObjectEditableController",link:function(a,g,d){var e,f,c,k,l,n,p,h;k=b.get("$builder");n=b.get("$drag");c=b.get("$parse");l=b.get("$compile");p=b.get("$validator");c=c(d.fbFormObjectEditable)(a);d=k.components[c.component];a.setupScope(c);h=l(d.template)(a);$(g).append(h);$(g).on("click",function(){return!1});if(c.editable)return n.draggable($(g),{object:{formObject:c}}),e="fb-"+Math.random().toString().substr(2),f=!1,c=null,c=d.popoverTemplate,c=$(c).addClass(e),a.popover={save:function(b){b.preventDefault();
p.validate(a).success(function(){f=!0;return $(g).popover("hide")})},remove:function(b){b.preventDefault();k.removeFormObject(a.formName,a.$index);$(g).popover("hide")},shown:function(){a.data.backup();return f=!1},cancel:function(b){a.data.rollback();b&&(b.preventDefault(),$(g).popover("hide"))}},c=l(c)(a),$(g).addClass(e),$(g).popover({html:!0,title:d.label,content:c,container:"body"}),$(g).on("show.bs.popover",function(){var a,b;if(n.isMouseMoved())return!1;$("div.fb-form-object-editable:not(."+
e+")").popover("hide");a=$("form."+e).closest(".popover");if(0<a.length)return b=$(g).offset().top+$(g).height()/2,b-=a.height()/2,a.css({position:"absolute",top:b}),a.show(),setTimeout(function(){a.addClass("in");return $(g).triggerHandler("shown.bs.popover")},0),!1}),$(g).on("shown.bs.popover",function(){$(".popover ."+e+" input:first").select();a.$apply(function(){return a.popover.shown()})}),$(g).on("hide.bs.popover",function(){var b;b=$("form."+e).closest(".popover");f||(a.$$phase?a.popover.cancel():
a.$apply(function(){return a.popover.cancel()}));b.removeClass("in");setTimeout(function(){return b.hide()},300);return!1})}}};c.$inject=["$injector"];h.directive("fbFormObjectEditable",c);h.directive("fbComponents",function(){return{restrict:"A",template:'<ul ng-if="groups.length > 1" class="nav nav-tabs nav-justified">\n    <li ng-repeat="group in groups" ng-class="{active:activeGroup==group}">\n        <a href=\'#\' ng-click="selectGroup($event, group)">{{group}}</a>\n    </li>\n</ul>\n<div class=\'form-horizontal\'>\n    <div class=\'fb-component\' ng-repeat="component in components"\n        fb-component="component"></div>\n</div>',
controller:"fbComponentsController"}});c=function(b){return{restrict:"A",controller:"fbComponentController",link:function(a,g,d){var e,f,c;b.get("$builder");f=b.get("$drag");c=b.get("$parse");e=b.get("$compile");d=c(d.fbComponent)(a);a.copyObjectToScope(d);f.draggable($(g),{mode:"mirror",defer:!1,object:{componentName:d.name}});a=e(d.template)(a);return $(g).append(a)}}};c.$inject=["$injector"];h.directive("fbComponent",c);c=function(b){return{restrict:"A",require:"ngModel",scope:{input:"=ngModel"},
template:'<div class=\'fb-form-object\' ng-repeat="object in form" fb-form-object="object">\n</div>',controller:"fbFormController",link:function(a,g,d){g=b.get("$builder");a.formName=d.fbForm;return a.form=g.forms[a.formName]}}};c.$inject=["$injector"];h.directive("fbForm",c);c=function(b){return{restrict:"A",controller:"fbFormObjectController",link:function(a,g,d){var c,f,m;c=b.get("$builder");f=b.get("$compile");m=b.get("$parse");a.formObject=m(d.fbFormObject)(a);m=c.components[a.formObject.component];
a.$on(c.broadcastChannel.updateInput,function(){return a.updateInput(a.inputText)});m.arrayToText&&(a.inputArray=[],a.$watch("inputArray",function(b,g){var d,c;if(b!==g){d=[];for(c in a.inputArray)a.inputArray[c]&&d.push(a.options[c]);return a.inputText=d.join(", ")}},!0));a.$watch("inputText",function(){return a.updateInput(a.inputText)});a.$watch(d.fbFormObject,function(){return a.copyObjectToScope(a.formObject)},!0);d=$(m.template);d.find("[ng-model='inputText']").attr({validator:"{{validation}}",
"validator-error":"{{errorMessage}}"});f=f(d)(a);$(g).append(f);if(!m.arrayToText&&0<a.formObject.options.length)return a.inputText=a.formObject.options[0]}}};c.$inject=["$injector"];h.directive("fbFormObject",c)}).call(this);
(function(){angular.module("builder.drag",[]).provider("$drag",function(){var h,c,b,a=this;c=h=null;this.data={draggables:{},droppables:{}};this.mouseMoved=!1;this.isMouseMoved=function(){return a.mouseMoved};this.hooks={down:{},move:{},up:{}};this.eventMouseMove=function(){};this.eventMouseUp=function(){};$(function(){$(document).on("mousedown",function(b){var d,c,f;a.mouseMoved=!1;f=a.hooks.down;for(c in f)d=f[c],d(b)});$(document).on("mousemove",function(b){var d,c,f;a.mouseMoved=!0;f=a.hooks.move;
for(c in f)d=f[c],d(b)});return $(document).on("mouseup",function(b){var d,c,f;f=a.hooks.up;for(c in f)d=f[c],d(b)})});this.currentId=0;this.getNewId=function(){return""+a.currentId++};this.setupEasing=function(){return jQuery.extend(jQuery.easing,{easeOutQuad:function(a,b,c,f,m){return-f*(b/=m)*(b-2)+c}})};this.setupProviders=function(a){h=a;return c=h.get("$rootScope")};this.isHover=function(a,b){var c,f,m,k,l,n,h;n=a.offset();h=b.offset();m=a.width();k=a.height();c=b.width();f=b.height();l={x:!1,
y:!1};l.x=n.left>h.left&&n.left<h.left+c;l.x=l.x||n.left+m>h.left&&n.left+m<h.left+c;if(!l)return!1;l.y=n.top>h.top&&n.top<h.top+f;l.y=l.y||n.top+k>h.top&&n.top+k<h.top+f;return l.x&&l.y};b=function(a,b){return setTimeout(function(){return b()},a)};this.autoScroll={up:!1,down:!1,scrolling:!1,scroll:function(){a.autoScroll.scrolling=!0;return a.autoScroll.up?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()-50},100,"easeOutQuad"),b(100,function(){return a.autoScroll.scroll()})):a.autoScroll.down?
($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()+50},100,"easeOutQuad"),b(100,function(){return a.autoScroll.scroll()})):a.autoScroll.scrolling=!1},start:function(b){if(50>b.clientY){if(a.autoScroll.up=!0,a.autoScroll.down=!1,!a.autoScroll.scrolling)return a.autoScroll.scroll()}else if(b.clientY>$(window).innerHeight()-50){if(a.autoScroll.up=!1,a.autoScroll.down=!0,!a.autoScroll.scrolling)return a.autoScroll.scroll()}else return a.autoScroll.up=!1,a.autoScroll.down=!1}};this.dragMirrorMode=
function(b,c,e){var f;null==c&&(c=!0);f={id:a.getNewId(),mode:"mirror",maternal:b[0],element:null,object:e};b.on("mousedown",function(e){var k;e.preventDefault();k=b.clone();f.element=k[0];k.addClass("fb-draggable form-horizontal prepare-dragging");a.hooks.move.drag=function(c,d){var e,h,m,q;if(k.hasClass("prepare-dragging")&&(k.css({width:b.width(),height:b.height()}),k.removeClass("prepare-dragging"),k.addClass("dragging"),d))return;k.offset({left:c.pageX-k.width()/2,top:c.pageY-k.height()/2});
a.autoScroll.start(c);m=a.data.droppables;q=[];for(h in m)e=m[h],a.isHover(k,$(e.element))?q.push(e.move(c,f)):q.push(e.out(c,f));return q};a.hooks.up.drag=function(b){var c,g,d,e;e=a.data.droppables;for(g in e)c=e[g],d=a.isHover(k,$(c.element)),c.up(b,d,f);delete a.hooks.move.drag;delete a.hooks.up.drag;f.element=null;return k.remove()};$("body").append(k);if(!c)return a.hooks.move.drag(e,c)});return f};this.dragDragMode=function(b,c,e){var f;null==c&&(c=!0);f={id:a.getNewId(),mode:"drag",maternal:null,
element:b[0],object:e};b.addClass("fb-draggable");b.on("mousedown",function(e){e.preventDefault();if(!b.hasClass("dragging")&&(b.addClass("prepare-dragging"),a.hooks.move.drag=function(c,d){var e,h,m;if(b.hasClass("prepare-dragging")&&(b.css({width:b.width(),height:b.height()}),b.removeClass("prepare-dragging"),b.addClass("dragging"),d))return;b.offset({left:c.pageX-b.width()/2,top:c.pageY-b.height()/2});a.autoScroll.start(c);m=a.data.droppables;for(h in m)e=m[h],a.isHover(b,$(e.element))?e.move(c,
f):e.out(c,f)},a.hooks.up.drag=function(c){var d,e,h,m;m=a.data.droppables;for(e in m)d=m[e],h=a.isHover(b,$(d.element)),d.up(c,h,f);delete a.hooks.move.drag;delete a.hooks.up.drag;b.css({width:"",height:"",left:"",top:""});return b.removeClass("dragging defer-dragging")},!c))return a.hooks.move.drag(e,c)});return f};this.dropMode=function(b,d){return{id:a.getNewId(),element:b[0],move:function(a,b){return c.$apply(function(){return"function"===typeof d.move?d.move(a,b):void 0})},up:function(a,b,g){return c.$apply(function(){return"function"===
typeof d.up?d.up(a,b,g):void 0})},out:function(a,b){return c.$apply(function(){return"function"===typeof d.out?d.out(a,b):void 0})}}};this.draggable=function(b,c){var e,f,h,k;null==c&&(c={});f=[];if("mirror"===c.mode)for(h=0,k=b.length;h<k;h++)e=b[h],e=a.dragMirrorMode($(e),c.defer,c.object),f.push(e.id),a.data.draggables[e.id]=e;else for(h=0,k=b.length;h<k;h++)e=b[h],e=a.dragDragMode($(e),c.defer,c.object),f.push(e.id),a.data.draggables[e.id]=e;return f};this.droppable=function(b,c){var e,f,h,k;
null==c&&(c={});f=[];h=0;for(k=b.length;h<k;h++)e=b[h],e=a.dropMode($(e),c),f.push(e),a.data.droppables[e.id]=e;return f};this.get=function(a){this.setupEasing();this.setupProviders(a);return{isMouseMoved:this.isMouseMoved,data:this.data,draggable:this.draggable,droppable:this.droppable}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);(function(){angular.module("builder",["builder.directive"])}).call(this);
(function(){var h=[].indexOf||function(c){for(var b=0,a=this.length;b<a;b++)if(b in this&&this[b]===c)return b;return-1};angular.module("builder.provider",[]).provider("$builder",function(){var c=this;this.components={};this.groups=[];this.broadcastChannel={updateInput:"$updateInput"};this.forms={"default":[]};this.formsId={"default":0};this.setupProviders=function(b){return b};this.convertComponent=function(b,a){var c,d,e,f,h,k,l,n,p,r,s;c={name:b,group:null!=(d=a.group)?d:"Default",label:null!=
(e=a.label)?e:"",description:null!=(f=a.description)?f:"",placeholder:null!=(h=a.placeholder)?h:"",editable:null!=(k=a.editable)?k:!0,required:null!=(l=a.required)?l:!1,validation:null!=(n=a.validation)?n:"/.*/",errorMessage:null!=(p=a.errorMessage)?p:"",options:null!=(r=a.options)?r:[],arrayToText:null!=(s=a.arrayToText)?s:!1,template:a.template,popoverTemplate:a.popoverTemplate};c.template||console.error("template is empty");c.popoverTemplate||console.error("popoverTemplate is empty");return c};
this.convertFormObject=function(b,a){var c,d,e,f,h,k,l,n,p,r,s,q,t,u,v,w;null==a&&(a={});c=this.components[a.component];null==c&&console.error("component "+a.component+" was not registered.");if(a.id){d=!1;k=this.forms[b];f=0;for(h=k.length;f<h;f++)if(e=k[f],a.id<=e.id){a.id=this.formsId[b]++;d=!0;break}d||(this.formsId[b]=a.id+1)}return{id:null!=(l=a.id)?l:this.formsId[b]++,component:a.component,editable:null!=(p=a.editable)?p:c.editable,index:null!=(r=a.index)?r:0,label:null!=(s=a.label)?s:c.label,
description:null!=(q=a.description)?q:c.description,placeholder:null!=(t=a.placeholder)?t:c.placeholder,options:null!=(u=a.options)?u:c.options,required:null!=(v=a.required)?v:c.required,validation:null!=(w=a.validation)?w:c.validation,errorMessage:null!=(n=a.errorMessage)?n:c.errorMessage}};this.reIndexFormObject=function(b){var a,g,d;b=c.forms[b];a=g=0;for(d=b.length-1;g<=d;a=g+=1)b[a].index=a};this.registerComponent=function(b,a){var g,d;null==a&&(a={});null==c.components[b]?(g=c.convertComponent(b,
a),c.components[b]=g,(d=g.group,0>h.call(c.groups,d))&&c.groups.push(g.group)):console.error("The component "+b+" was registered.")};this.addFormObject=function(b,a){var g,d;null==a&&(a={});null==(g=c.forms)[b]&&(g[b]=[]);null==(d=c.formsId)[b]&&(d[b]=0);return c.insertFormObject(b,c.forms[b].length,a)};this.insertFormObject=function(b,a,g){var d,e;null==g&&(g={});null==(d=c.forms)[b]&&(d[b]=[]);null==(e=c.formsId)[b]&&(e[b]=0);a>c.forms.length?a=c.forms.length:0>a&&(a=0);c.forms[b].splice(a,0,c.convertFormObject(b,
g));return c.reIndexFormObject(b)};this.removeFormObject=function(b,a){c.forms[b].splice(a,1);return c.reIndexFormObject(b)};this.updateFormObjectIndex=function(b,a,g){var d;if(a!==g)return d=c.forms[b],a=d.splice(a,1)[0],d.splice(g,0,a),c.reIndexFormObject(b)};this.get=function(b){this.setupProviders(b);return{components:this.components,groups:this.groups,forms:this.forms,broadcastChannel:this.broadcastChannel,registerComponent:this.registerComponent,addFormObject:this.addFormObject,insertFormObject:this.insertFormObject,
removeFormObject:this.removeFormObject,updateFormObjectIndex:this.updateFormObjectIndex}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);
