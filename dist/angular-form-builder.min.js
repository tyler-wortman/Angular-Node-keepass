(function(){var g;g=function(d,e){var b,a;for(b in d)a=d[b],"$$hashKey"!==b&&(e[b]=a)};angular.module("builder.controller",["builder.provider"]).controller("fbFormObjectEditableController",["$scope","$injector",function(d,e){var b;b=e.get("$builder");d.setupScope=function(a){g(a,d);d.optionsText=a.options.join("\n");d.$watch("[label, description, placeholder, required, options, validation]",function(){a.label=d.label;a.description=d.description;a.placeholder=d.placeholder;a.required=d.required;a.options=
d.options;return a.validation=d.validation},!0);d.$watch("optionsText",function(a){var f,b,k,q;k=a.split("\n");q=[];f=0;for(b=k.length;f<b;f++)a=k[f],0<a.length&&q.push(a);d.options=q;return d.inputText=d.options[0]});return d.validationOptions=b.components[a.component].validationOptions};return d.data={model:null,backup:function(){return this.model={label:d.label,description:d.description,placeholder:d.placeholder,required:d.required,optionsText:d.optionsText,validation:d.validation}},rollback:function(){if(this.model)return d.label=
this.model.label,d.description=this.model.description,d.placeholder=this.model.placeholder,d.required=this.model.required,d.optionsText=this.model.optionsText,d.validation=this.model.validation}}}]).controller("fbComponentsController",["$scope","$injector",function(d,e){var b;b=e.get("$builder");d.selectGroup=function(a,c){var f,h,k,q;null!=a&&a.preventDefault();d.activeGroup=c;d.components=[];k=b.components;q=[];for(h in k)f=k[h],f.group===c&&q.push(d.components.push(f));return q};d.groups=b.groups;
d.activeGroup=d.groups[0];d.allComponents=b.components;return d.$watch("allComponents",function(){return d.selectGroup(null,d.activeGroup)})}]).controller("fbComponentController",["$scope",function(d){return d.copyObjectToScope=function(e){return g(e,d)}}]).controller("fbFormController",["$scope","$injector",function(d,e){var b,a;b=e.get("$builder");a=e.get("$timeout");null==d.input&&(d.input=[]);return d.$watch("form",function(){d.input.length>d.form.length&&d.input.splice(d.form.length);return a(function(){return d.$broadcast(b.broadcastChannel.updateInput)})},
!0)}]).controller("fbFormObjectController",["$scope","$injector",function(d,e){e.get("$builder");d.copyObjectToScope=function(b){return g(b,d)};return d.updateInput=function(b){return d.$parent.input.splice(d.$index,1,{id:d.formObject.id,label:d.formObject.label,value:null!=b?b:""})}}])}).call(this);
(function(){angular.module("builder.directive",["builder.provider","builder.controller","builder.drag","validator"]).directive("fbBuilder",["$injector",function(g){var d,e;d=g.get("$builder");e=g.get("$drag");return{restrict:"A",scope:{fbBuilder:"="},template:"<div class='form-horizontal'>\n    <div class='fb-form-object-editable' ng-repeat=\"object in formObjects\"\n        fb-form-object-editable=\"object\"></div>\n</div>",link:function(b,a,c){var f,h,k;b.formName=c.fbBuilder;null==(h=d.forms)[k=
b.formName]&&(h[k]=[]);b.formObjects=d.forms[b.formName];f=!0;$(a).addClass("fb-builder");return e.droppable($(a),{move:function(c){var b,h,d,k,e,g;f&&($("div.fb-form-object-editable").popover("hide"),f=!1);h=$(a).find(".fb-form-object-editable:not(.empty,.dragging)");if(0===h.length)0===$(a).find(".fb-form-object-editable.empty").length&&$(a).find(">div:first").append($("<div class='fb-form-object-editable empty'></div>"));else{k=[];k.push(-1E3);d=e=0;for(g=h.length;e<g;d=e+=1)b=$(h[d]),d=b.offset(),
b=b.height(),k.push(d.top+b/2);k.push(k[k.length-1]+1E3);d=e=1;for(g=k.length;e<g;d=e+=1)if(c.pageY>k[d-1]&&c.pageY<=k[d]){$(a).find(".empty").remove();c=$("<div class='fb-form-object-editable empty'></div>");d-1<h.length?c.insertBefore($(h[d-1])):c.insertAfter($(h[d-2]));break}}},out:function(){f&&($("div.fb-form-object-editable").popover("hide"),f=!1);return $(a).find(".empty").remove()},up:function(h,k,l){f=!0;if(e.isMouseMoved())return k||"drag"!==l.mode?k&&("mirror"===l.mode&&d.insertFormObject(b.formName,
$(a).find(".empty").index(".fb-form-object-editable"),{component:l.object.componentName}),"drag"===l.mode&&(k=l.object.formObject.index,h=$(a).find(".empty").index(".fb-form-object-editable"),k<h&&h--,d.updateFormObjectIndex(b.formName,k,h))):(h=l.object.formObject,h.editable&&d.removeFormObject(c.fbBuilder,h.index)),$(a).find(".empty").remove();$(a).find(".empty").remove()}})}}}]).directive("fbFormObjectEditable",["$injector",function(g){var d,e,b,a;d=g.get("$builder");b=g.get("$drag");e=g.get("$compile");
a=g.get("$validator");return{restrict:"A",controller:"fbFormObjectEditableController",scope:{formObject:"=fbFormObjectEditable"},link:function(c,f){var h;c.inputArray=[];c.$component=d.components[c.formObject.component];c.setupScope(c.formObject);c.$watch("$component.template",function(a){if(a)return a=e(a)(c),$(f).html(a)});$(f).on("click",function(){return!1});b.draggable($(f),{object:{formObject:c.formObject}});if(c.formObject.editable)return h={},c.$watch("$component.popoverTemplate",function(a){if(a)return $(f).removeClass(h.id),
h={id:"fb-"+Math.random().toString().substr(2),isClickedSave:!1,view:null,html:a},h.html=$(h.html).addClass(h.id),h.view=e(h.html)(c),$(f).addClass(h.id),$(f).popover({html:!0,title:c.$component.label,content:h.view,container:"body"})}),c.popover={save:function(b){b.preventDefault();a.validate(c).success(function(){h.isClickedSave=!0;return $(f).popover("hide")})},remove:function(a){a.preventDefault();d.removeFormObject(c.$parent.formName,c.$parent.$index);$(f).popover("hide")},shown:function(){c.data.backup();
return h.isClickedSave=!1},cancel:function(a){c.data.rollback();a&&(a.preventDefault(),$(f).popover("hide"))}},$(f).on("show.bs.popover",function(){var a,c;if(b.isMouseMoved())return!1;$("div.fb-form-object-editable:not(."+h.id+")").popover("hide");a=$("form."+h.id).closest(".popover");if(0<a.length)return c=$(f).offset().top+$(f).height()/2,c-=a.height()/2,a.css({position:"absolute",top:c}),a.show(),setTimeout(function(){a.addClass("in");return $(f).triggerHandler("shown.bs.popover")},0),!1}),$(f).on("shown.bs.popover",
function(){$(".popover ."+h.id+" input:first").select();c.$apply(function(){return c.popover.shown()})}),$(f).on("hide.bs.popover",function(){var a;a=$("form."+h.id).closest(".popover");h.isClickedSave||(c.$$phase||c.$root.$$phase?c.popover.cancel():c.$apply(function(){return c.popover.cancel()}));a.removeClass("in");setTimeout(function(){return a.hide()},300);return!1})}}}]).directive("fbComponents",function(){return{restrict:"A",template:'<ul ng-if="groups.length > 1" class="nav nav-tabs nav-justified">\n    <li ng-repeat="group in groups" ng-class="{active:activeGroup==group}">\n        <a href=\'#\' ng-click="selectGroup($event, group)">{{group}}</a>\n    </li>\n</ul>\n<div class=\'form-horizontal\'>\n    <div class=\'fb-component\' ng-repeat="component in components"\n        fb-component="component"></div>\n</div>',
controller:"fbComponentsController"}}).directive("fbComponent",["$injector",function(g){var d,e;g.get("$builder");e=g.get("$drag");d=g.get("$compile");return{restrict:"A",scope:{component:"=fbComponent"},controller:"fbComponentController",link:function(b,a){b.copyObjectToScope(b.component);e.draggable($(a),{mode:"mirror",defer:!1,object:{componentName:b.component.name}});return b.$watch("component.template",function(c){if(c)return c=d(c)(b),$(a).html(c)})}}}]).directive("fbForm",["$injector",function(g){return{restrict:"A",
require:"ngModel",scope:{formName:"@fbForm",input:"=ngModel","default":"=fbDefault"},template:'<div class=\'fb-form-object\' ng-repeat="object in form" fb-form-object="object"></div>',controller:"fbFormController",link:function(d,e,b){var a,c;e=g.get("$builder");null==(a=e.forms)[c=d.formName]&&(a[c]=[]);return d.form=e.forms[d.formName]}}}]).directive("fbFormObject",["$injector",function(g){var d,e,b;d=g.get("$builder");e=g.get("$compile");b=g.get("$parse");return{restrict:"A",controller:"fbFormObjectController",
link:function(a,c,f){a.formObject=b(f.fbFormObject)(a);a.$component=d.components[a.formObject.component];a.$on(d.broadcastChannel.updateInput,function(){return a.updateInput(a.inputText)});a.$component.arrayToText&&(a.inputArray=[],a.$watch("inputArray",function(c,b){var f,d;if(c!==b){f=[];for(d in a.inputArray)a.inputArray[d]&&f.push(a.options[d]);return a.inputText=f.join(", ")}},!0));a.$watch("inputText",function(){return a.updateInput(a.inputText)});a.$watch(f.fbFormObject,function(){return a.copyObjectToScope(a.formObject)},
!0);a.$watch("$component.template",function(b){var f;if(b)return f=$(b),b=f.find("[ng-model='inputText']"),b.attr({validator:"{{validation}}"}),b=e(f)(a),$(c).html(b)});!a.$component.arrayToText&&0<a.formObject.options.length&&(a.inputText=a.formObject.options[0]);return a.$watch("default["+a.formObject.id+"]",function(c){if(c)return a.$component.arrayToText?a.inputArray=c:a.inputText=c})}}}])}).call(this);
(function(){angular.module("builder.drag",[]).provider("$drag",function(){var g,d,e;d=g=null;this.data={draggables:{},droppables:{}};this.mouseMoved=!1;this.isMouseMoved=function(b){return function(){return b.mouseMoved}}(this);this.hooks={down:{},move:{},up:{}};this.eventMouseMove=function(){};this.eventMouseUp=function(){};$(function(b){return function(){$(document).on("mousedown",function(a){var c,f,h;b.mouseMoved=!1;h=b.hooks.down;for(f in h)c=h[f],c(a)});$(document).on("mousemove",function(a){var c,
f,h;b.mouseMoved=!0;h=b.hooks.move;for(f in h)c=h[f],c(a)});return $(document).on("mouseup",function(a){var c,f,h;h=b.hooks.up;for(f in h)c=h[f],c(a)})}}(this));this.currentId=0;this.getNewId=function(b){return function(){return""+b.currentId++}}(this);this.setupEasing=function(){return jQuery.extend(jQuery.easing,{easeOutQuad:function(b,a,c,f,h){return-f*(a/=h)*(a-2)+c}})};this.setupProviders=function(b){g=b;return d=g.get("$rootScope")};this.isHover=function(b){return function(a,c){var b,h,d,e,
g,l,m;l=a.offset();m=c.offset();d=a.width();e=a.height();b=c.width();h=c.height();g={x:!1,y:!1};g.x=l.left>m.left&&l.left<m.left+b;g.x=g.x||l.left+d>m.left&&l.left+d<m.left+b;if(!g)return!1;g.y=l.top>m.top&&l.top<m.top+h;g.y=g.y||l.top+e>m.top&&l.top+e<m.top+h;return g.x&&g.y}}(this);e=function(b,a){return setTimeout(function(){return a()},b)};this.autoScroll={up:!1,down:!1,scrolling:!1,scroll:function(b){return function(){b.autoScroll.scrolling=!0;return b.autoScroll.up?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()-
50},100,"easeOutQuad"),e(100,function(){return b.autoScroll.scroll()})):b.autoScroll.down?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()+50},100,"easeOutQuad"),e(100,function(){return b.autoScroll.scroll()})):b.autoScroll.scrolling=!1}}(this),start:function(b){return function(a){if(50>a.clientY){if(b.autoScroll.up=!0,b.autoScroll.down=!1,!b.autoScroll.scrolling)return b.autoScroll.scroll()}else if(a.clientY>$(window).innerHeight()-50){if(b.autoScroll.up=!1,b.autoScroll.down=!0,
!b.autoScroll.scrolling)return b.autoScroll.scroll()}else return b.autoScroll.up=!1,b.autoScroll.down=!1}}(this),stop:function(b){return function(){b.autoScroll.up=!1;return b.autoScroll.down=!1}}(this)};this.dragMirrorMode=function(b){return function(a,c,f){var d;null==c&&(c=!0);d={id:b.getNewId(),mode:"mirror",maternal:a[0],element:null,object:f};a.on("mousedown",function(f){var e;f.preventDefault();e=a.clone();d.element=e[0];e.addClass("fb-draggable form-horizontal prepare-dragging");b.hooks.move.drag=
function(c,f){var k,g,p,n;if(e.hasClass("prepare-dragging")&&(e.css({width:a.width(),height:a.height()}),e.removeClass("prepare-dragging"),e.addClass("dragging"),f))return;e.offset({left:c.pageX-e.width()/2,top:c.pageY-e.height()/2});b.autoScroll.start(c);p=b.data.droppables;n=[];for(g in p)k=p[g],b.isHover(e,$(k.element))?n.push(k.move(c,d)):n.push(k.out(c,d));return n};b.hooks.up.drag=function(a){var c,f,k,g;g=b.data.droppables;for(f in g)c=g[f],k=b.isHover(e,$(c.element)),c.up(a,k,d);delete b.hooks.move.drag;
delete b.hooks.up.drag;d.element=null;e.remove();return b.autoScroll.stop()};$("body").append(e);if(!c)return b.hooks.move.drag(f,c)});return d}}(this);this.dragDragMode=function(b){return function(a,c,f){var d;null==c&&(c=!0);d={id:b.getNewId(),mode:"drag",maternal:null,element:a[0],object:f};a.addClass("fb-draggable");a.on("mousedown",function(f){f.preventDefault();if(!a.hasClass("dragging")&&(a.addClass("prepare-dragging"),b.hooks.move.drag=function(c,f){var e,k,g;if(a.hasClass("prepare-dragging")&&
(a.css({width:a.width(),height:a.height()}),a.removeClass("prepare-dragging"),a.addClass("dragging"),f))return;a.offset({left:c.pageX-a.width()/2,top:c.pageY-a.height()/2});b.autoScroll.start(c);g=b.data.droppables;for(k in g)e=g[k],b.isHover(a,$(e.element))?e.move(c,d):e.out(c,d)},b.hooks.up.drag=function(c){var f,e,k,g;g=b.data.droppables;for(e in g)f=g[e],k=b.isHover(a,$(f.element)),f.up(c,k,d);delete b.hooks.move.drag;delete b.hooks.up.drag;a.css({width:"",height:"",left:"",top:""});a.removeClass("dragging defer-dragging");
return b.autoScroll.stop()},!c))return b.hooks.move.drag(f,c)});return d}}(this);this.dropMode=function(b){return function(a,c){return{id:b.getNewId(),element:a[0],move:function(a,b){return d.$apply(function(){return"function"===typeof c.move?c.move(a,b):void 0})},up:function(a,b,e){return d.$apply(function(){return"function"===typeof c.up?c.up(a,b,e):void 0})},out:function(a,b){return d.$apply(function(){return"function"===typeof c.out?c.out(a,b):void 0})}}}}(this);this.draggable=function(b){return function(a,
c){var f,d,e,g;null==c&&(c={});d=[];if("mirror"===c.mode)for(e=0,g=a.length;e<g;e++)f=a[e],f=b.dragMirrorMode($(f),c.defer,c.object),d.push(f.id),b.data.draggables[f.id]=f;else for(e=0,g=a.length;e<g;e++)f=a[e],f=b.dragDragMode($(f),c.defer,c.object),d.push(f.id),b.data.draggables[f.id]=f;return d}}(this);this.droppable=function(b){return function(a,c){var f,d,e,g;null==c&&(c={});d=[];e=0;for(g=a.length;e<g;e++)f=a[e],f=b.dropMode($(f),c),d.push(f),b.data.droppables[f.id]=f;return d}}(this);this.get=
function(b){this.setupEasing();this.setupProviders(b);return{isMouseMoved:this.isMouseMoved,data:this.data,draggable:this.draggable,droppable:this.droppable}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);(function(){angular.module("builder",["builder.directive"])}).call(this);
(function(){var g=[].indexOf||function(d){for(var e=0,b=this.length;e<b;e++)if(e in this&&this[e]===d)return e;return-1};angular.module("builder.provider",[]).provider("$builder",function(){var d,e,b;b=d=e=null;this.version="0.0.2";this.components={};this.groups=[];this.broadcastChannel={updateInput:"$updateInput"};this.forms={"default":[]};this.formsId={"default":0};this.convertComponent=function(a,c){var b,d,e,g,r,l,m,s,p,n,t;b={name:a,group:null!=(d=c.group)?d:"Default",label:null!=(e=c.label)?
e:"",description:null!=(g=c.description)?g:"",placeholder:null!=(r=c.placeholder)?r:"",editable:null!=(l=c.editable)?l:!0,required:null!=(m=c.required)?m:!1,validation:null!=(s=c.validation)?s:"/.*/",validationOptions:null!=(p=c.validationOptions)?p:[],options:null!=(n=c.options)?n:[],arrayToText:null!=(t=c.arrayToText)?t:!1,template:c.template,templateUrl:c.templateUrl,popoverTemplate:c.popoverTemplate,popoverTemplateUrl:c.popoverTemplateUrl};b.template||b.templateUrl||console.error("The template is empty.");
b.popoverTemplate||b.popoverTemplateUrl||console.error("The popoverTemplate is empty.");return b};this.convertFormObject=function(a,c){var b,d,e,g,r,l,m,s,p,n,t,u,v,w,x;null==c&&(c={});b=this.components[c.component];if(null==b)throw"The component "+c.component+" was not registered.";if(c.id){d=!1;l=this.forms[a];g=0;for(r=l.length;g<r;g++)if(e=l[g],c.id<=e.id){c.id=this.formsId[a]++;d=!0;break}d||(this.formsId[a]=c.id+1)}return{id:null!=(m=c.id)?m:this.formsId[a]++,component:c.component,editable:null!=
(s=c.editable)?s:b.editable,index:null!=(p=c.index)?p:0,label:null!=(n=c.label)?n:b.label,description:null!=(t=c.description)?t:b.description,placeholder:null!=(u=c.placeholder)?u:b.placeholder,options:null!=(v=c.options)?v:b.options,required:null!=(w=c.required)?w:b.required,validation:null!=(x=c.validation)?x:b.validation}};this.reindexFormObject=function(a){return function(c){var b,d,e;c=a.forms[c];b=d=0;for(e=c.length;d<e;b=d+=1)c[b].index=b}}(this);this.setupProviders=function(a){return function(a){e=
a;d=e.get("$http");return b=e.get("$templateCache")}}(this);this.loadTemplate=function(a){null==a.template&&d.get(a.templateUrl,{cache:b}).success(function(c){return a.template=c});if(null==a.popoverTemplate)return d.get(a.popoverTemplateUrl,{cache:b}).success(function(c){return a.popoverTemplate=c})};this.registerComponent=function(a){return function(c,b){var d,k;null==b&&(b={});null==a.components[c]?(d=a.convertComponent(c,b),a.components[c]=d,null!=e&&a.loadTemplate(d),(k=d.group,0>g.call(a.groups,
k))&&a.groups.push(d.group)):console.error("The component "+c+" was registered.")}}(this);this.addFormObject=function(a){return function(c,b){var d;null==b&&(b={});null==(d=a.forms)[c]&&(d[c]=[]);return a.insertFormObject(c,a.forms[c].length,b)}}(this);this.insertFormObject=function(a){return function(c,b,d){var e,g;null==d&&(d={});null==(e=a.forms)[c]&&(e[c]=[]);null==(g=a.formsId)[c]&&(g[c]=0);b>a.forms[c].length?b=a.forms[c].length:0>b&&(b=0);a.forms[c].splice(b,0,a.convertFormObject(c,d));a.reindexFormObject(c);
return a.forms[c][b]}}(this);this.removeFormObject=function(a){return function(c,b){a.forms[c].splice(b,1);return a.reindexFormObject(c)}}(this);this.updateFormObjectIndex=function(a){return function(c,b,d){var e;if(b!==d)return e=a.forms[c],b=e.splice(b,1)[0],e.splice(d,0,b),a.reindexFormObject(c)}}(this);this.$get=["$injector",function(a){return function(b){var d,e;a.setupProviders(b);e=a.components;for(d in e)b=e[d],a.loadTemplate(b);return{version:a.version,components:a.components,groups:a.groups,
forms:a.forms,broadcastChannel:a.broadcastChannel,registerComponent:a.registerComponent,addFormObject:a.addFormObject,insertFormObject:a.insertFormObject,removeFormObject:a.removeFormObject,updateFormObjectIndex:a.updateFormObjectIndex}}}(this)]})}).call(this);
