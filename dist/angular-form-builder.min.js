(function(){var l,c,b;l=angular.module("builder.controller",["builder.provider"]);c=function(a,d){var e,f;for(e in a)f=a[e],"$$hashKey"!==e&&(d[e]=f)};b=function(a,d){var e;e=d.get("$builder");a.setupScope=function(d){c(d,a);a.optionsText=d.options.join("\n");a.$watch("[label, description, placeholder, required, options, validation]",function(){d.label=a.label;d.description=a.description;d.placeholder=a.placeholder;d.required=a.required;d.options=a.options;return d.validation=a.validation},!0);a.$watch("optionsText",
function(d){var e,f,b,m;b=d.split("\n");m=[];e=0;for(f=b.length;e<f;e++)d=b[e],0<d.length&&m.push(d);a.options=m;return a.inputText=a.options[0]});return a.validationOptions=e.components[d.component].validationOptions};return a.data={model:null,backup:function(){return this.model={label:a.label,description:a.description,placeholder:a.placeholder,required:a.required,optionsText:a.optionsText,validation:a.validation}},rollback:function(){if(this.model)return a.label=this.model.label,a.description=this.model.description,
a.placeholder=this.model.placeholder,a.required=this.model.required,a.optionsText=this.model.optionsText,a.validation=this.model.validation}}};b.$inject=["$scope","$injector"];l.controller("fbFormObjectEditableController",b);b=function(a,d){var e;e=d.get("$builder");a.selectGroup=function(d,b){var g,k,c,m;null!=d&&d.preventDefault();a.activeGroup=b;a.components=[];c=e.components;m=[];for(k in c)g=c[k],g.group===b&&m.push(a.components.push(g));return m};a.groups=e.groups;a.activeGroup=a.groups[0];
a.allComponents=e.components;return a.$watch("allComponents",function(){return a.selectGroup(null,a.activeGroup)})};b.$inject=["$scope","$injector"];l.controller("fbComponentsController",b);b=function(a){return a.copyObjectToScope=function(d){return c(d,a)}};b.$inject=["$scope"];l.controller("fbComponentController",b);b=function(a,d){var e,b;e=d.get("$builder");b=d.get("$timeout");return a.$watch("form",function(){a.input.length>a.form.length&&a.input.splice(a.form.length);return b(function(){return a.$broadcast(e.broadcastChannel.updateInput)})},
!0)};b.$inject=["$scope","$injector"];l.controller("fbFormController",b);b=function(a,d){d.get("$builder");a.copyObjectToScope=function(d){return c(d,a)};return a.updateInput=function(d){return a.$parent.input.splice(a.$index,1,{id:a.formObject.id,label:a.formObject.label,value:null!=d?d:""})}};b.$inject=["$scope","$injector"];l.controller("fbFormObjectController",b)}).call(this);
(function(){var l,c;l=angular.module("builder.directive",["builder.provider","builder.controller","builder.drag","validator"]);c=function(b){return{restrict:"A",template:"<div class='form-horizontal'>\n    <div class='fb-form-object-editable' ng-repeat=\"object in formObjects\"\n        fb-form-object-editable=\"object\"></div>\n</div>",link:function(a,d,e){var f,h,g,c,p;f=b.get("$builder");h=b.get("$drag");a.formName=e.fbBuilder;null==(c=f.forms)[p=a.formName]&&(c[p]=[]);a.formObjects=f.forms[a.formName];
g=!0;$(d).addClass("fb-builder");return h.droppable($(d),{move:function(a){var e,b,f,h,c,k;g&&($("div.fb-form-object-editable").popover("hide"),g=!1);b=$(d).find(".fb-form-object-editable:not(.empty,.dragging)");if(0===b.length)0===$(d).find(".fb-form-object-editable.empty").length&&$(d).find(">div:first").append($("<div class='fb-form-object-editable empty'></div>"));else{h=[];h.push(-1E3);f=c=0;for(k=b.length-1;c<=k;f=c+=1)e=$(b[f]),f=e.offset(),e=e.height(),h.push(f.top+e/2);h.push(h[h.length-
1]+1E3);f=c=1;for(k=h.length-1;c<=k;f=c+=1)if(a.pageY>h[f-1]&&a.pageY<=h[f]){$(d).find(".empty").remove();a=$("<div class='fb-form-object-editable empty'></div>");f-1<b.length?a.insertBefore($(b[f-1])):a.insertAfter($(b[f-2]));break}}},out:function(){g&&($("div.fb-form-object-editable").popover("hide"),g=!1);return $(d).find(".empty").remove()},up:function(b,c,k){g=!0;if(h.isMouseMoved())return c||"drag"!==k.mode?c&&("mirror"===k.mode&&f.insertFormObject(a.formName,$(d).find(".empty").index(".fb-form-object-editable"),
{component:k.object.componentName}),"drag"===k.mode&&(c=k.object.formObject.index,b=$(d).find(".empty").index(".fb-form-object-editable"),c<b&&b--,f.updateFormObjectIndex(a.formName,c,b))):(b=k.object.formObject,b.editable&&f.removeFormObject(e.fbBuilder,b.index)),$(d).find(".empty").remove();$(d).find(".empty").remove()}})}}};c.$inject=["$injector"];l.directive("fbBuilder",c);c=function(b){return{restrict:"A",controller:"fbFormObjectEditableController",link:function(a,d,e){var f,h,c,k,p,m,n,q;k=
b.get("$builder");m=b.get("$drag");c=b.get("$parse");p=b.get("$compile");n=b.get("$validator");c=c(e.fbFormObjectEditable)(a);e=k.components[c.component];a.setupScope(c);q=p(e.template)(a);$(d).append(q);$(d).on("click",function(){return!1});m.draggable($(d),{object:{formObject:c}});if(c.editable)return f="fb-"+Math.random().toString().substr(2),h=!1,c=null,c=e.popoverTemplate,c=$(c).addClass(f),a.popover={save:function(e){e.preventDefault();n.validate(a).success(function(){h=!0;return $(d).popover("hide")})},
remove:function(e){e.preventDefault();k.removeFormObject(a.formName,a.$index);$(d).popover("hide")},shown:function(){a.data.backup();return h=!1},cancel:function(e){a.data.rollback();e&&(e.preventDefault(),$(d).popover("hide"))}},c=p(c)(a),$(d).addClass(f),$(d).popover({html:!0,title:e.label,content:c,container:"body"}),$(d).on("show.bs.popover",function(){var a,e;if(m.isMouseMoved())return!1;$("div.fb-form-object-editable:not(."+f+")").popover("hide");a=$("form."+f).closest(".popover");if(0<a.length)return e=
$(d).offset().top+$(d).height()/2,e-=a.height()/2,a.css({position:"absolute",top:e}),a.show(),setTimeout(function(){a.addClass("in");return $(d).triggerHandler("shown.bs.popover")},0),!1}),$(d).on("shown.bs.popover",function(){$(".popover ."+f+" input:first").select();a.$apply(function(){return a.popover.shown()})}),$(d).on("hide.bs.popover",function(){var d;d=$("form."+f).closest(".popover");h||(a.$$phase?a.popover.cancel():a.$apply(function(){return a.popover.cancel()}));d.removeClass("in");setTimeout(function(){return d.hide()},
300);return!1})}}};c.$inject=["$injector"];l.directive("fbFormObjectEditable",c);l.directive("fbComponents",function(){return{restrict:"A",template:'<ul ng-if="groups.length > 1" class="nav nav-tabs nav-justified">\n    <li ng-repeat="group in groups" ng-class="{active:activeGroup==group}">\n        <a href=\'#\' ng-click="selectGroup($event, group)">{{group}}</a>\n    </li>\n</ul>\n<div class=\'form-horizontal\'>\n    <div class=\'fb-component\' ng-repeat="component in components"\n        fb-component="component"></div>\n</div>',
controller:"fbComponentsController"}});c=function(b){return{restrict:"A",controller:"fbComponentController",link:function(a,d,e){var f,c,g;b.get("$builder");c=b.get("$drag");g=b.get("$parse");f=b.get("$compile");e=g(e.fbComponent)(a);a.copyObjectToScope(e);c.draggable($(d),{mode:"mirror",defer:!1,object:{componentName:e.name}});a=f(e.template)(a);return $(d).append(a)}}};c.$inject=["$injector"];l.directive("fbComponent",c);c=function(b){return{restrict:"A",require:"ngModel",scope:{input:"=ngModel"},
template:'<div class=\'fb-form-object\' ng-repeat="object in form" fb-form-object="object"></div>',controller:"fbFormController",link:function(a,d,e){d=b.get("$builder");a.formName=e.fbForm;return a.form=d.forms[a.formName]}}};c.$inject=["$injector"];l.directive("fbForm",c);c=function(b){return{restrict:"A",controller:"fbFormObjectController",link:function(a,d,e){var f,c,g;f=b.get("$builder");c=b.get("$compile");g=b.get("$parse");a.formObject=g(e.fbFormObject)(a);g=f.components[a.formObject.component];
a.$on(f.broadcastChannel.updateInput,function(){return a.updateInput(a.inputText)});g.arrayToText&&(a.inputArray=[],a.$watch("inputArray",function(d,e){var b,c;if(d!==e){b=[];for(c in a.inputArray)a.inputArray[c]&&b.push(a.options[c]);return a.inputText=b.join(", ")}},!0));a.$watch("inputText",function(){return a.updateInput(a.inputText)});a.$watch(e.fbFormObject,function(){return a.copyObjectToScope(a.formObject)},!0);e=$(g.template);e.find("[ng-model='inputText']").attr({validator:"{{validation}}",
"validator-error":"{{errorMessage}}"});c=c(e)(a);$(d).append(c);if(!g.arrayToText&&0<a.formObject.options.length)return a.inputText=a.formObject.options[0]}}};c.$inject=["$injector"];l.directive("fbFormObject",c)}).call(this);
(function(){angular.module("builder.drag",[]).provider("$drag",function(){var l,c,b,a=this;c=l=null;this.data={draggables:{},droppables:{}};this.mouseMoved=!1;this.isMouseMoved=function(){return a.mouseMoved};this.hooks={down:{},move:{},up:{}};this.eventMouseMove=function(){};this.eventMouseUp=function(){};$(function(){$(document).on("mousedown",function(d){var e,b,c;a.mouseMoved=!1;c=a.hooks.down;for(b in c)e=c[b],e(d)});$(document).on("mousemove",function(d){var e,b,c;a.mouseMoved=!0;c=a.hooks.move;
for(b in c)e=c[b],e(d)});return $(document).on("mouseup",function(d){var e,b,c;c=a.hooks.up;for(b in c)e=c[b],e(d)})});this.currentId=0;this.getNewId=function(){return""+a.currentId++};this.setupEasing=function(){return jQuery.extend(jQuery.easing,{easeOutQuad:function(a,e,b,c,g){return-c*(e/=g)*(e-2)+b}})};this.setupProviders=function(a){l=a;return c=l.get("$rootScope")};this.isHover=function(a,e){var b,c,g,k,p,m,n;m=a.offset();n=e.offset();g=a.width();k=a.height();b=e.width();c=e.height();p={x:!1,
y:!1};p.x=m.left>n.left&&m.left<n.left+b;p.x=p.x||m.left+g>n.left&&m.left+g<n.left+b;if(!p)return!1;p.y=m.top>n.top&&m.top<n.top+c;p.y=p.y||m.top+k>n.top&&m.top+k<n.top+c;return p.x&&p.y};b=function(a,e){return setTimeout(function(){return e()},a)};this.autoScroll={up:!1,down:!1,scrolling:!1,scroll:function(){a.autoScroll.scrolling=!0;return a.autoScroll.up?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()-50},100,"easeOutQuad"),b(100,function(){return a.autoScroll.scroll()})):a.autoScroll.down?
($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()+50},100,"easeOutQuad"),b(100,function(){return a.autoScroll.scroll()})):a.autoScroll.scrolling=!1},start:function(d){if(50>d.clientY){if(a.autoScroll.up=!0,a.autoScroll.down=!1,!a.autoScroll.scrolling)return a.autoScroll.scroll()}else if(d.clientY>$(window).innerHeight()-50){if(a.autoScroll.up=!1,a.autoScroll.down=!0,!a.autoScroll.scrolling)return a.autoScroll.scroll()}else return a.autoScroll.up=!1,a.autoScroll.down=!1},stop:function(){a.autoScroll.up=
!1;return a.autoScroll.down=!1}};this.dragMirrorMode=function(d,e,b){var c;null==e&&(e=!0);c={id:a.getNewId(),mode:"mirror",maternal:d[0],element:null,object:b};d.on("mousedown",function(b){var f;b.preventDefault();f=d.clone();c.element=f[0];f.addClass("fb-draggable form-horizontal prepare-dragging");a.hooks.move.drag=function(b,e){var g,q,l,r;if(f.hasClass("prepare-dragging")&&(f.css({width:d.width(),height:d.height()}),f.removeClass("prepare-dragging"),f.addClass("dragging"),e))return;f.offset({left:b.pageX-
f.width()/2,top:b.pageY-f.height()/2});a.autoScroll.start(b);l=a.data.droppables;r=[];for(q in l)g=l[q],a.isHover(f,$(g.element))?r.push(g.move(b,c)):r.push(g.out(b,c));return r};a.hooks.up.drag=function(d){var b,e,g,l;l=a.data.droppables;for(e in l)b=l[e],g=a.isHover(f,$(b.element)),b.up(d,g,c);delete a.hooks.move.drag;delete a.hooks.up.drag;c.element=null;f.remove();return a.autoScroll.stop()};$("body").append(f);if(!e)return a.hooks.move.drag(b,e)});return c};this.dragDragMode=function(d,b,c){var h;
null==b&&(b=!0);h={id:a.getNewId(),mode:"drag",maternal:null,element:d[0],object:c};d.addClass("fb-draggable");d.on("mousedown",function(c){c.preventDefault();if(!d.hasClass("dragging")&&(d.addClass("prepare-dragging"),a.hooks.move.drag=function(b,e){var c,f,g;if(d.hasClass("prepare-dragging")&&(d.css({width:d.width(),height:d.height()}),d.removeClass("prepare-dragging"),d.addClass("dragging"),e))return;d.offset({left:b.pageX-d.width()/2,top:b.pageY-d.height()/2});a.autoScroll.start(b);g=a.data.droppables;
for(f in g)c=g[f],a.isHover(d,$(c.element))?c.move(b,h):c.out(b,h)},a.hooks.up.drag=function(b){var c,e,f,g;g=a.data.droppables;for(e in g)c=g[e],f=a.isHover(d,$(c.element)),c.up(b,f,h);delete a.hooks.move.drag;delete a.hooks.up.drag;d.css({width:"",height:"",left:"",top:""});d.removeClass("dragging defer-dragging");return a.autoScroll.stop()},!b))return a.hooks.move.drag(c,b)});return h};this.dropMode=function(d,b){return{id:a.getNewId(),element:d[0],move:function(a,d){return c.$apply(function(){return"function"===
typeof b.move?b.move(a,d):void 0})},up:function(a,d,g){return c.$apply(function(){return"function"===typeof b.up?b.up(a,d,g):void 0})},out:function(a,d){return c.$apply(function(){return"function"===typeof b.out?b.out(a,d):void 0})}}};this.draggable=function(d,b){var c,h,g,k;null==b&&(b={});h=[];if("mirror"===b.mode)for(g=0,k=d.length;g<k;g++)c=d[g],c=a.dragMirrorMode($(c),b.defer,b.object),h.push(c.id),a.data.draggables[c.id]=c;else for(g=0,k=d.length;g<k;g++)c=d[g],c=a.dragDragMode($(c),b.defer,
b.object),h.push(c.id),a.data.draggables[c.id]=c;return h};this.droppable=function(b,c){var f,h,g,k;null==c&&(c={});h=[];g=0;for(k=b.length;g<k;g++)f=b[g],f=a.dropMode($(f),c),h.push(f),a.data.droppables[f.id]=f;return h};this.get=function(a){this.setupEasing();this.setupProviders(a);return{isMouseMoved:this.isMouseMoved,data:this.data,draggable:this.draggable,droppable:this.droppable}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);(function(){angular.module("builder",["builder.directive"])}).call(this);
(function(){var l=[].indexOf||function(c){for(var b=0,a=this.length;b<a;b++)if(b in this&&this[b]===c)return b;return-1};angular.module("builder.provider",[]).provider("$builder",function(){var c=this;this.components={};this.groups=[];this.broadcastChannel={updateInput:"$updateInput"};this.forms={"default":[]};this.formsId={"default":0};this.convertComponent=function(b,a){var d,c,f,h,g,k,l,m,n,q,s,r;d={name:b,group:null!=(c=a.group)?c:"Default",label:null!=(f=a.label)?f:"",description:null!=(g=a.description)?
g:"",placeholder:null!=(k=a.placeholder)?k:"",editable:null!=(l=a.editable)?l:!0,required:null!=(m=a.required)?m:!1,validation:null!=(n=a.validation)?n:"/.*/",validationOptions:null!=(q=a.validationOptions)?q:[],errorMessage:null!=(s=a.errorMessage)?s:"",options:null!=(r=a.options)?r:[],arrayToText:null!=(h=a.arrayToText)?h:!1,template:a.template,popoverTemplate:a.popoverTemplate};d.template||console.error("The template is empty.");d.popoverTemplate||console.error("The popoverTemplate is empty.");
return d};this.convertFormObject=function(b,a){var d,c,f,h,g,k,l,m,n,q,s,r,t,u,v,w;null==a&&(a={});d=this.components[a.component];if(null==d)throw"The component "+a.component+" was not registered.";if(a.id){c=!1;k=this.forms[b];h=0;for(g=k.length;h<g;h++)if(f=k[h],a.id<=f.id){a.id=this.formsId[b]++;c=!0;break}c||(this.formsId[b]=a.id+1)}return{id:null!=(l=a.id)?l:this.formsId[b]++,component:a.component,editable:null!=(n=a.editable)?n:d.editable,index:null!=(q=a.index)?q:0,label:null!=(s=a.label)?
s:d.label,description:null!=(r=a.description)?r:d.description,placeholder:null!=(t=a.placeholder)?t:d.placeholder,options:null!=(u=a.options)?u:d.options,required:null!=(v=a.required)?v:d.required,validation:null!=(w=a.validation)?w:d.validation,errorMessage:null!=(m=a.errorMessage)?m:d.errorMessage}};this.reindexFormObject=function(b){var a,d,e;b=c.forms[b];a=d=0;for(e=b.length-1;d<=e;a=d+=1)b[a].index=a};this.registerComponent=function(b,a){var d,e;null==a&&(a={});null==c.components[b]?(d=c.convertComponent(b,
a),c.components[b]=d,(e=d.group,0>l.call(c.groups,e))&&c.groups.push(d.group)):console.error("The component "+b+" was registered.")};this.addFormObject=function(b,a){var d;null==a&&(a={});null==(d=c.forms)[b]&&(d[b]=[]);return c.insertFormObject(b,c.forms[b].length,a)};this.insertFormObject=function(b,a,d){var e,f;null==d&&(d={});null==(e=c.forms)[b]&&(e[b]=[]);null==(f=c.formsId)[b]&&(f[b]=0);a>c.forms[b].length?a=c.forms[b].length:0>a&&(a=0);c.forms[b].splice(a,0,c.convertFormObject(b,d));return c.reindexFormObject(b)};
this.removeFormObject=function(b,a){c.forms[b].splice(a,1);return c.reindexFormObject(b)};this.updateFormObjectIndex=function(b,a,d){var e;if(a!==d)return e=c.forms[b],a=e.splice(a,1)[0],e.splice(d,0,a),c.reindexFormObject(b)};this.$get=this.get=function(){return{components:this.components,groups:this.groups,forms:this.forms,broadcastChannel:this.broadcastChannel,registerComponent:this.registerComponent,addFormObject:this.addFormObject,insertFormObject:this.insertFormObject,removeFormObject:this.removeFormObject,
updateFormObjectIndex:this.updateFormObjectIndex}}})}).call(this);
