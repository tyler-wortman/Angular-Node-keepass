(function(){var k,d;k=angular.module("builder.controller",["builder.provider"]);d=function(b,a){return a.get("$builder")};d.$inject=["$scope","$injector"];k.controller("fbBuilderController",d);d=function(b,a){var c;c=a.get("$builder");b.groups=c.groups;b.components=c.componentsArray;b.status={activeGroup:b.groups[0]};return b.action={selectGroup:function(a,c){a.preventDefault();return b.status.activeGroup=c}}};d.$inject=["$scope","$injector"];k.controller("fbComponentsController",d);d=function(b,
a){return a.get("$builder")};d.$inject=["$scope","$injector"];k.controller("fbFormController",d)}).call(this);
(function(){var k,d;k=angular.module("builder.directive",["builder.provider","builder.controller","builder.drag","validator.rules"]);d=function(b){return{restrict:"A",template:"<div class='form-horizontal'>\n    <div class='fb-form-object-editable' ng-repeat=\"object in formObjects\"\n        fb-form-object-editable=\"object\"></div>\n</div>",controller:"fbBuilderController",link:function(a,c,e){var g,f,q,d,h;g=b.get("$builder");f=b.get("$drag");d=e.fbBuilder;null==(h=g.forms)[d]&&(h[d]=[]);a.formObjects=
g.forms[d];q=!0;$(c).addClass("fb-builder");return f.droppable($(c),{mode:"custom",move:function(a,b){var e,g,d,f,h,l;q&&($("div.fb-form-object-editable").popover("hide"),q=!1);d=$(c).find(".fb-form-object-editable:not(.empty,.dragging)");if(0===d.length)0===$(c).find(".fb-form-object-editable.empty").length&&$(c).find(">div:first").append($("<div class='fb-form-object-editable empty'></div>"));else{e=[];e.push(-1E3);e.push($(d[0]).offset().top+$(d[0]).height()/2);f=h=0;for(l=d.length-1;h<=l;f=h+=
1)0!==f&&(g=$(d[f]),f=g.offset(),g=g.height(),e.push(f.top+g/2));e.push(e[e.length-1]+1E3);f=h=0;for(l=e.length-1;h<=l;f=h+=1)if(0!==f&&a.pageY>e[f-1]&&a.pageY<=e[f]){$(c).find(".empty").remove();e=$("<div class='fb-form-object-editable empty'></div>");f-1<d.length?e.insertBefore($(d[f-1])):e.insertAfter($(d[f-2]));break}}},out:function(a,b){q&&($("div.fb-form-object-editable").popover("hide"),q=!1);return $(c).find(".empty").remove()},up:function(a,b,h){q=!0;if(f.isMouseMoved())return b||"drag"!==
h.mode?b&&("mirror"===h.mode&&g.insertFormObject(d,$(c).find(".empty").index(".fb-form-object-editable"),{component:h.object.componentName}),"drag"===h.mode&&(b=h.object.formObject.index,a=$(c).find(".empty").index(".fb-form-object-editable"),b<a&&a--,g.updateFormObjectIndex(d,b,a))):(a=h.object.formObject,g.removeFormObject(e.fbBuilder,a.index)),$(c).find(".empty").remove()}})}}};d.$inject=["$injector"];k.directive("fbBuilder",d);d=function(b){return{restrict:"A",link:function(a,c,e){var g,f,d,l,
h,m,p,n,r;d=b.get("$builder");h=b.get("$drag");m=b.get("$parse");l=b.get("$compile");p=b.get("$validator");n=m(e.fbFormObjectEditable)(a);e=d.components[n.component];for(f in n)m=n[f],"$$hashKey"!==f&&(a[f]=m);a.optionsText=n.options.join("\n");a.$watch("[label, description, placeholder, required, options]",function(){n.label=a.label;n.description=a.description;n.placeholder=a.placeholder;n.required=a.required;return n.options=a.options},!0);a.$watch("optionsText",function(c){var b,e,g,f;g=c.split("\n");
f=[];b=0;for(e=g.length;b<e;b++)c=g[b],0<c.length&&f.push(c);a.options=f;return a.inputText=a.options[0]});h.draggable($(c),{object:{formObject:n}});f=$(e.template);f=l(f)(a);$(c).append(f);$(c).on("click",function(){return!1});r="fb-"+Math.random().toString().substr(2);g=!1;f=null;f=e.popoverTemplate;f=$(f).addClass(r);a.popover={ngModel:null,save:function(b){b.preventDefault();p.validate(a).success(function(){g=!0;return $(c).popover("hide")})},remove:function(b){b.preventDefault();b=$(c).closest("[fb-builder]").attr("fb-builder");
d.removeFormObject(b,a.$index);$(c).popover("hide")},shown:function(){this.ngModel={label:a.label,description:a.description,placeholder:a.placeholder,required:a.required,optionsText:a.optionsText};return g=!1},cancel:function(b){this.ngModel&&(a.label=this.ngModel.label,a.description=this.ngModel.description,a.placeholder=this.ngModel.placeholder,a.required=this.ngModel.required,a.optionsText=this.ngModel.optionsText);b&&(b.preventDefault(),$(c).popover("hide"))}};f=l(f)(a);$(c).addClass(r);$(c).popover({html:!0,
title:e.label,content:f,container:"body"});$(c).on("show.bs.popover",function(){var a,b;if(h.isMouseMoved())return!1;$("div.fb-form-object-editable:not(."+r+")").popover("hide");a=$("form."+r).closest(".popover");if(0<a.length)return b=$(c).offset().top+$(c).height()/2,b-=a.height()/2,a.css({position:"absolute",top:b}),a.show(),setTimeout(function(){a.addClass("in");return $(c).triggerHandler("shown.bs.popover")},0),!1});$(c).on("shown.bs.popover",function(){$(".popover ."+r+" input:first").select();
a.$apply(function(){return a.popover.shown()})});return $(c).on("hide.bs.popover",function(){var b;b=$("form."+r).closest(".popover");g||(a.$$phase?a.popover.cancel():a.$apply(function(){return a.popover.cancel()}));b.removeClass("in");setTimeout(function(){return b.hide()},300);return!1})}}};d.$inject=["$injector"];k.directive("fbFormObjectEditable",d);k.directive("fbComponents",function(){return{restrict:"A",template:'<ul ng-if="groups.length > 1" class="nav nav-tabs nav-justified">\n    <li ng-repeat="group in groups" ng-class="{active:status.activeGroup==group}">\n        <a href=\'#\' ng-click="action.selectGroup($event, group)">{{group}}</a>\n    </li>\n</ul>\n<div class=\'form-horizontal\'>\n    <div class=\'fb-component\'\n        ng-repeat="component in components|filter:{group:status.activeGroup}"\n        fb-component="component"></div>\n</div>',
controller:"fbComponentsController"}});d=function(b){return{restrict:"A",link:function(a,c,e){var g,f,d,l;b.get("$builder");f=b.get("$drag");d=b.get("$parse");g=b.get("$compile");l=a.$new();a=d(e.fbComponent)(a);$.extend(l,a);f.draggable($(c),{mode:"mirror",defer:!1,object:{componentName:a.name}});f=$(a.template);g=g(f)(l);return $(c).append(g)}}};d.$inject=["$injector"];k.directive("fbComponent",d);d=function(b){return{restrict:"A",require:"ngModel",scope:{input:"=ngModel"},template:'<div class=\'fb-form-object\' ng-repeat="object in form" fb-form-object="object">\n</div>',
controller:"fbFormController",link:function(a,c,e){var g;g=b.get("$builder");a.form=g.forms[e.fbForm];return a.$watch("form",function(){a.input.length>a.form.length&&a.input.splice(a.form.length);return a.$broadcast(g.broadcastChannel.updateInput)},!0)}}};d.$inject=["$injector"];k.directive("fbForm",d);d=function(b){return{restrict:"A",link:function(a,c,e){var g,f,d,l,h,m;g=b.get("$builder");f=b.get("$compile");h=b.get("$parse")(e.fbFormObject)(a);d=g.components[h.component];m=function(b){return a.$parent.input.splice(a.$index,
1,{label:h.label,value:null!=b?b:""})};l=function(){var b,c,e;e=[];for(b in h)c=h[b],"$$hashKey"!==b&&e.push(a[b]=c);return e};a.$on(g.broadcastChannel.updateInput,function(){return m()});d.arrayToText&&(a.inputArray=[],a.$watch("inputArray",function(b,c){var e,g;if(b!==c){e=[];for(g in a.inputArray)a.inputArray[g]&&e.push(a.options[g]);return a.inputText=e.join(", ")}},!0));a.$watch("inputText",function(){return m(a.inputText)});a.$watch(e.fbFormObject,function(){return l()},!0);e=$(d.template);
e.find("[ng-model='inputText']").attr({validator:"{{validation}}","validator-error":"{{errorMessage}}"});f=f(e)(a);$(c).append(f);if(!d.arrayToText&&0<h.options.length)return a.inputText=h.options[0]}}};d.$inject=["$injector"];k.directive("fbFormObject",d)}).call(this);
(function(){angular.module("builder.drag",[]).provider("$drag",function(){var k,d,b=this;d=k=null;this.data={draggables:{},droppables:{}};this.mouseMoved=!1;this.isMouseMoved=function(){return b.mouseMoved};this.hooks={down:{},move:{},up:{}};this.eventMouseMove=function(){};this.eventMouseUp=function(){};$(function(){$(document).on("mousedown",function(a){var c,e,g;b.mouseMoved=!1;g=b.hooks.down;for(e in g)c=g[e],c(a)});$(document).on("mousemove",function(a){var c,e,g;b.mouseMoved=!0;g=b.hooks.move;
for(e in g)c=g[e],c(a)});return $(document).on("mouseup",function(a){var c,e,g;g=b.hooks.up;for(e in g)c=g[e],c(a)})});this.currentId=0;this.getNewId=function(){return""+b.currentId++};this.setupProviders=function(a){k=a;return d=k.get("$rootScope")};this.isHover=function(a,b){var e,g,d,q,l,h,m;h=a.offset();m=b.offset();d=a.width();q=a.height();e=b.width();g=b.height();l={x:!1,y:!1};l.x=h.left>m.left&&h.left<m.left+e;l.x=l.x||h.left+d>m.left&&h.left+d<m.left+e;if(!l)return!1;l.y=h.top>m.top&&h.top<
m.top+g;l.y=l.y||h.top+q>m.top&&h.top+q<m.top+g;return l.x&&l.y};this.dragMirrorMode=function(a,c,e){var g;null==c&&(c=!0);g={id:b.getNewId(),mode:"mirror",maternal:a[0],element:null,object:e};a.on("mousedown",function(e){var d;e.preventDefault();d=a.clone();g.element=d[0];d.addClass("fb-draggable form-horizontal prepare-dragging");b.hooks.move.drag=function(c,e){var f,p,n,k;if(d.hasClass("prepare-dragging")&&(d.css({width:a.width(),height:a.height()}),d.removeClass("prepare-dragging"),d.addClass("dragging"),
e))return;d.offset({left:c.pageX-d.width()/2,top:c.pageY-d.height()/2});n=b.data.droppables;k=[];for(p in n)f=n[p],b.isHover(d,$(f.element))?k.push(f.move(c,g)):k.push(f.out(c,g));return k};b.hooks.up.drag=function(a){var c,e,f,n;n=b.data.droppables;for(e in n)c=n[e],f=b.isHover(d,$(c.element)),c.up(a,f,g);delete b.hooks.move.drag;delete b.hooks.up.drag;g.element=null;return d.remove()};$("body").append(d);if(!c)return b.hooks.move.drag(e,c)});return g};this.dragDragMode=function(a,c,e){var d;null==
c&&(c=!0);d={id:b.getNewId(),mode:"drag",maternal:null,element:a[0],object:e};a.addClass("fb-draggable");a.on("mousedown",function(e){e.preventDefault();if(!a.hasClass("dragging")&&(a.addClass("prepare-dragging"),b.hooks.move.drag=function(c,e){var f,m,k;if(a.hasClass("prepare-dragging")&&(a.css({width:a.width(),height:a.height()}),a.removeClass("prepare-dragging"),a.addClass("dragging"),e))return;a.offset({left:c.pageX-a.width()/2,top:c.pageY-a.height()/2});k=b.data.droppables;for(m in k)f=k[m],
b.isHover(a,$(f.element))?f.move(c,d):f.out(c,d)},b.hooks.up.drag=function(c){var e,f,m,k;k=b.data.droppables;for(f in k)e=k[f],m=b.isHover(a,$(e.element)),e.up(c,m,d);delete b.hooks.move.drag;delete b.hooks.up.drag;a.css({width:"",height:"",left:"",top:""});return a.removeClass("dragging defer-dragging")},!c))return b.hooks.move.drag(e,c)});return d};this.dropCustomMode=function(a,c){return{id:b.getNewId(),mode:"custom",element:a[0],move:function(a,b){return d.$apply(function(){return"function"===
typeof c.move?c.move(a,b):void 0})},up:function(a,b,f){return d.$apply(function(){return"function"===typeof c.up?c.up(a,b,f):void 0})},out:function(a,b){return d.$apply(function(){return"function"===typeof c.out?c.out(a,b):void 0})}}};this.draggable=function(a,c){var e,d,f,k;null==c&&(c={});d=[];if("mirror"===c.mode)for(f=0,k=a.length;f<k;f++)e=a[f],e=b.dragMirrorMode($(e),c.defer,c.object),d.push(e.id),b.data.draggables[e.id]=e;else for(f=0,k=a.length;f<k;f++)e=a[f],e=b.dragDragMode($(e),c.defer,
c.object),d.push(e.id),b.data.draggables[e.id]=e;return d};this.droppable=function(a,c){var e,d,f,k;null==c&&(c={});d=[];if("custom"===c.mode)for(f=0,k=a.length;f<k;f++)e=a[f],e=b.dropCustomMode($(e),c),d.push(e),b.data.droppables[e.id]=e;return d};this.get=function(a){this.setupProviders(a);return{isMouseMoved:this.isMouseMoved,data:this.data,draggable:this.draggable,droppable:this.droppable}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);(function(){angular.module("builder",["builder.directive"])}).call(this);
(function(){var k=[].indexOf||function(d){for(var b=0,a=this.length;b<a;b++)if(b in this&&this[b]===d)return b;return-1};angular.module("builder.provider",[]).provider("$builder",function(){var d=this;this.components={};this.componentsArray=[];this.groups=[];this.broadcastChannel={updateInput:"$updateInput"};this.forms={};this.forms["default"]=[];this.setupProviders=function(b){return b};this.convertComponent=function(b,a){var c,d,g,f,k,l,h,m,p,n;c={name:b,group:null!=(d=a.group)?d:"Default",label:null!=
(g=a.label)?g:"",description:null!=(f=a.description)?f:"",placeholder:null!=(k=a.placeholder)?k:"",required:null!=(l=a.required)?l:!1,validation:null!=(h=a.validation)?h:"/.*/",errorMessage:null!=(m=a.errorMessage)?m:"",options:null!=(p=a.options)?p:[],arrayToText:null!=(n=a.arrayToText)?n:!1,template:a.template,popoverTemplate:a.popoverTemplate};c.template||console.error("template is empty");c.popoverTemplate||console.error("popoverTemplate is empty");return c};this.convertFormObject=function(b,
a){var c,d,g,f,k,l,h,m,p,n;null==a&&(a={});c=this.components[a.component];null==c&&console.error("component "+a.component+" was not registered.");return{component:a.component,draggable:null!=(d=a.draggable)?d:!0,index:null!=(g=a.index)?g:0,label:null!=(f=a.label)?f:c.label,description:null!=(k=a.description)?k:c.description,placeholder:null!=(l=a.placeholder)?l:c.placeholder,options:null!=(h=a.options)?h:c.options,required:null!=(m=a.required)?m:c.required,validation:null!=(p=a.validation)?p:c.validation,
errorMessage:null!=(n=a.errorMessage)?n:c.errorMessage}};this.reIndexFormObject=function(b){var a,c,e;b=d.forms[b];a=c=0;for(e=b.length-1;c<=e;a=c+=1)b[a].index=a};this.registerComponent=function(b,a){var c,e;null==a&&(a={});null==d.components[b]?(c=d.convertComponent(b,a),d.components[b]=c,d.componentsArray.push(c),(e=c.group,0>k.call(d.groups,e))&&d.groups.push(c.group)):console.error("The component "+b+" was registered.")};this.addFormObject=function(b,a){var c;null==a&&(a={});null==(c=d.forms)[b]&&
(c[b]=[]);return d.insertFormObject(b,d.forms[b].length,a)};this.insertFormObject=function(b,a,c){var e;null==c&&(c={});null==(e=d.forms)[b]&&(e[b]=[]);a>d.forms.length?a=d.forms.length:0>a&&(a=0);d.forms[b].splice(a,0,d.convertFormObject(b,c));return d.reIndexFormObject(b)};this.removeFormObject=function(b,a){d.forms[b].splice(a,1);return d.reIndexFormObject(b)};this.updateFormObjectIndex=function(b,a,c){var e;if(a!==c)return e=d.forms[b],a=e.splice(a,1)[0],e.splice(c,0,a),d.reIndexFormObject(b)};
this.get=function(b){this.setupProviders(b);return{components:this.components,componentsArray:this.componentsArray,groups:this.groups,forms:this.forms,broadcastChannel:this.broadcastChannel,registerComponent:this.registerComponent,addFormObject:this.addFormObject,insertFormObject:this.insertFormObject,removeFormObject:this.removeFormObject,updateFormObjectIndex:this.updateFormObjectIndex}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);
