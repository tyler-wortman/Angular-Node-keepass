(function(){var h,c;h=angular.module("builder.controller",["builder.provider"]);c=function(b,a){return a.get("$builder")};c.$inject=["$scope","$injector"];h.controller("fbBuilderController",c);c=function(b,a){var e;e=a.get("$builder");b.selectGroup=function(a,g){var f,c,k,l;null!=a&&a.preventDefault();b.activeGroup=g;b.components=[];k=e.components;l=[];for(c in k)f=k[c],f.group===g&&l.push(b.components.push(f));return l};b.groups=e.groups;b.activeGroup=b.groups[0];b.allComponents=e.components;return b.$watch("allComponents",
function(){return b.selectGroup(null,b.activeGroup)})};c.$inject=["$scope","$injector"];h.controller("fbComponentsController",c);c=function(b,a){return a.get("$builder")};c.$inject=["$scope","$injector"];h.controller("fbFormController",c)}).call(this);
(function(){var h,c;h=angular.module("builder.directive",["builder.provider","builder.controller","builder.drag","validator.rules"]);c=function(b){return{restrict:"A",template:"<div class='form-horizontal'>\n    <div class='fb-form-object-editable' ng-repeat=\"object in formObjects\"\n        fb-form-object-editable=\"object\"></div>\n</div>",controller:"fbBuilderController",link:function(a,e,d){var g,f,c,k,l;g=b.get("$builder");f=b.get("$drag");k=d.fbBuilder;null==(l=g.forms)[k]&&(l[k]=[]);a.formObjects=
g.forms[k];c=!0;$(e).addClass("fb-builder");return f.droppable($(e),{mode:"custom",move:function(a,f){var d,b,g,k,l,h;c&&($("div.fb-form-object-editable").popover("hide"),c=!1);g=$(e).find(".fb-form-object-editable:not(.empty,.dragging)");if(0===g.length)0===$(e).find(".fb-form-object-editable.empty").length&&$(e).find(">div:first").append($("<div class='fb-form-object-editable empty'></div>"));else{d=[];d.push(-1E3);d.push($(g[0]).offset().top+$(g[0]).height()/2);k=l=0;for(h=g.length-1;l<=h;k=l+=
1)0!==k&&(b=$(g[k]),k=b.offset(),b=b.height(),d.push(k.top+b/2));d.push(d[d.length-1]+1E3);k=l=0;for(h=d.length-1;l<=h;k=l+=1)if(0!==k&&a.pageY>d[k-1]&&a.pageY<=d[k]){$(e).find(".empty").remove();d=$("<div class='fb-form-object-editable empty'></div>");k-1<g.length?d.insertBefore($(g[k-1])):d.insertAfter($(g[k-2]));break}}},out:function(a,d){c&&($("div.fb-form-object-editable").popover("hide"),c=!1);return $(e).find(".empty").remove()},up:function(a,b,l){c=!0;if(f.isMouseMoved())return b||"drag"!==
l.mode?b&&("mirror"===l.mode&&g.insertFormObject(k,$(e).find(".empty").index(".fb-form-object-editable"),{component:l.object.componentName}),"drag"===l.mode&&(b=l.object.formObject.index,a=$(e).find(".empty").index(".fb-form-object-editable"),b<a&&a--,g.updateFormObjectIndex(k,b,a))):(a=l.object.formObject,g.removeFormObject(d.fbBuilder,a.index)),$(e).find(".empty").remove();$(e).find(".empty").remove()}})}}};c.$inject=["$injector"];h.directive("fbBuilder",c);c=function(b){return{restrict:"A",link:function(a,
e,d){var g,f,c,k,l,m,p,n,q;c=b.get("$builder");l=b.get("$drag");m=b.get("$parse");k=b.get("$compile");p=b.get("$validator");n=m(d.fbFormObjectEditable)(a);d=c.components[n.component];for(f in n)m=n[f],"$$hashKey"!==f&&(a[f]=m);a.optionsText=n.options.join("\n");a.$watch("[label, description, placeholder, required, options]",function(){n.label=a.label;n.description=a.description;n.placeholder=a.placeholder;n.required=a.required;return n.options=a.options},!0);a.$watch("optionsText",function(e){var d,
b,f,g;f=e.split("\n");g=[];d=0;for(b=f.length;d<b;d++)e=f[d],0<e.length&&g.push(e);a.options=g;return a.inputText=a.options[0]});l.draggable($(e),{object:{formObject:n}});f=$(d.template);f=k(f)(a);$(e).append(f);$(e).on("click",function(){return!1});q="fb-"+Math.random().toString().substr(2);g=!1;f=null;f=d.popoverTemplate;f=$(f).addClass(q);a.popover={ngModel:null,save:function(d){d.preventDefault();p.validate(a).success(function(){g=!0;return $(e).popover("hide")})},remove:function(d){d.preventDefault();
d=$(e).closest("[fb-builder]").attr("fb-builder");c.removeFormObject(d,a.$index);$(e).popover("hide")},shown:function(){this.ngModel={label:a.label,description:a.description,placeholder:a.placeholder,required:a.required,optionsText:a.optionsText};return g=!1},cancel:function(d){this.ngModel&&(a.label=this.ngModel.label,a.description=this.ngModel.description,a.placeholder=this.ngModel.placeholder,a.required=this.ngModel.required,a.optionsText=this.ngModel.optionsText);d&&(d.preventDefault(),$(e).popover("hide"))}};
f=k(f)(a);$(e).addClass(q);$(e).popover({html:!0,title:d.label,content:f,container:"body"});$(e).on("show.bs.popover",function(){var a,d;if(l.isMouseMoved())return!1;$("div.fb-form-object-editable:not(."+q+")").popover("hide");a=$("form."+q).closest(".popover");if(0<a.length)return d=$(e).offset().top+$(e).height()/2,d-=a.height()/2,a.css({position:"absolute",top:d}),a.show(),setTimeout(function(){a.addClass("in");return $(e).triggerHandler("shown.bs.popover")},0),!1});$(e).on("shown.bs.popover",
function(){$(".popover ."+q+" input:first").select();a.$apply(function(){return a.popover.shown()})});return $(e).on("hide.bs.popover",function(){var e;e=$("form."+q).closest(".popover");g||(a.$$phase?a.popover.cancel():a.$apply(function(){return a.popover.cancel()}));e.removeClass("in");setTimeout(function(){return e.hide()},300);return!1})}}};c.$inject=["$injector"];h.directive("fbFormObjectEditable",c);h.directive("fbComponents",function(){return{restrict:"A",template:'<ul ng-if="groups.length > 1" class="nav nav-tabs nav-justified">\n    <li ng-repeat="group in groups" ng-class="{active:activeGroup==group}">\n        <a href=\'#\' ng-click="selectGroup($event, group)">{{group}}</a>\n    </li>\n</ul>\n<div class=\'form-horizontal\'>\n    <div class=\'fb-component\' ng-repeat="component in components"\n        fb-component="component"></div>\n</div>',
controller:"fbComponentsController"}});c=function(b){return{restrict:"A",link:function(a,e,d){var g,f,c,k;b.get("$builder");f=b.get("$drag");c=b.get("$parse");g=b.get("$compile");k=a.$new();a=c(d.fbComponent)(a);$.extend(k,a);f.draggable($(e),{mode:"mirror",defer:!1,object:{componentName:a.name}});f=$(a.template);g=g(f)(k);return $(e).append(g)}}};c.$inject=["$injector"];h.directive("fbComponent",c);c=function(b){return{restrict:"A",require:"ngModel",scope:{input:"=ngModel"},template:'<div class=\'fb-form-object\' ng-repeat="object in form" fb-form-object="object">\n</div>',
controller:"fbFormController",link:function(a,e,d){var g,f;g=b.get("$builder");f=b.get("$timeout");a.form=g.forms[d.fbForm];return a.$watch("form",function(){a.input.length>a.form.length&&a.input.splice(a.form.length);return f(function(){return a.$broadcast(g.broadcastChannel.updateInput)})},!0)}}};c.$inject=["$injector"];h.directive("fbForm",c);c=function(b){return{restrict:"A",link:function(a,e,d){var g,f,c,k,l,m;g=b.get("$builder");f=b.get("$compile");l=b.get("$parse")(d.fbFormObject)(a);c=g.components[l.component];
m=function(e){return a.$parent.input.splice(a.$index,1,{id:l.id,label:l.label,value:null!=e?e:""})};k=function(){var e,d,b;b=[];for(e in l)d=l[e],"$$hashKey"!==e&&b.push(a[e]=d);return b};a.$on(g.broadcastChannel.updateInput,function(){return m(a.inputText)});c.arrayToText&&(a.inputArray=[],a.$watch("inputArray",function(e,d){var b,f;if(e!==d){b=[];for(f in a.inputArray)a.inputArray[f]&&b.push(a.options[f]);return a.inputText=b.join(", ")}},!0));a.$watch("inputText",function(){return m(a.inputText)});
a.$watch(d.fbFormObject,function(){return k()},!0);d=$(c.template);d.find("[ng-model='inputText']").attr({validator:"{{validation}}","validator-error":"{{errorMessage}}"});f=f(d)(a);$(e).append(f);if(!c.arrayToText&&0<l.options.length)return a.inputText=l.options[0]}}};c.$inject=["$injector"];h.directive("fbFormObject",c)}).call(this);
(function(){angular.module("builder.drag",[]).provider("$drag",function(){var h,c,b,a=this;c=h=null;this.data={draggables:{},droppables:{}};this.mouseMoved=!1;this.isMouseMoved=function(){return a.mouseMoved};this.hooks={down:{},move:{},up:{}};this.eventMouseMove=function(){};this.eventMouseUp=function(){};$(function(){$(document).on("mousedown",function(e){var d,b,f;a.mouseMoved=!1;f=a.hooks.down;for(b in f)d=f[b],d(e)});$(document).on("mousemove",function(e){var d,b,f;a.mouseMoved=!0;f=a.hooks.move;
for(b in f)d=f[b],d(e)});return $(document).on("mouseup",function(e){var d,b,f;f=a.hooks.up;for(b in f)d=f[b],d(e)})});this.currentId=0;this.getNewId=function(){return""+a.currentId++};this.setupEasing=function(){return jQuery.extend(jQuery.easing,{easeOutQuad:function(a,d,b,f,c){return-f*(d/=c)*(d-2)+b}})};this.setupProviders=function(a){h=a;return c=h.get("$rootScope")};this.isHover=function(a,d){var b,f,c,k,l,m,p;m=a.offset();p=d.offset();c=a.width();k=a.height();b=d.width();f=d.height();l={x:!1,
y:!1};l.x=m.left>p.left&&m.left<p.left+b;l.x=l.x||m.left+c>p.left&&m.left+c<p.left+b;if(!l)return!1;l.y=m.top>p.top&&m.top<p.top+f;l.y=l.y||m.top+k>p.top&&m.top+k<p.top+f;return l.x&&l.y};b=function(a,d){return setTimeout(function(){return d()},a)};this.autoScroll={up:!1,down:!1,scrolling:!1,scroll:function(){a.autoScroll.scrolling=!0;return a.autoScroll.up?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()-50},100,"easeOutQuad"),b(100,function(){return a.autoScroll.scroll()})):a.autoScroll.down?
($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()+50},100,"easeOutQuad"),b(100,function(){return a.autoScroll.scroll()})):a.autoScroll.scrolling=!1},start:function(e){if(50>e.clientY){if(a.autoScroll.up=!0,a.autoScroll.down=!1,!a.autoScroll.scrolling)return a.autoScroll.scroll()}else if(e.clientY>$(window).innerHeight()-50){if(a.autoScroll.up=!1,a.autoScroll.down=!0,!a.autoScroll.scrolling)return a.autoScroll.scroll()}else return a.autoScroll.up=!1,a.autoScroll.down=!1}};this.dragMirrorMode=
function(e,d,b){var f;null==d&&(d=!0);f={id:a.getNewId(),mode:"mirror",maternal:e[0],element:null,object:b};e.on("mousedown",function(b){var c;b.preventDefault();c=e.clone();f.element=c[0];c.addClass("fb-draggable form-horizontal prepare-dragging");a.hooks.move.drag=function(b,d){var g,n,r,h;if(c.hasClass("prepare-dragging")&&(c.css({width:e.width(),height:e.height()}),c.removeClass("prepare-dragging"),c.addClass("dragging"),d))return;c.offset({left:b.pageX-c.width()/2,top:b.pageY-c.height()/2});
a.autoScroll.start(b);r=a.data.droppables;h=[];for(n in r)g=r[n],a.isHover(c,$(g.element))?h.push(g.move(b,f)):h.push(g.out(b,f));return h};a.hooks.up.drag=function(e){var b,d,g,h;h=a.data.droppables;for(d in h)b=h[d],g=a.isHover(c,$(b.element)),b.up(e,g,f);delete a.hooks.move.drag;delete a.hooks.up.drag;f.element=null;return c.remove()};$("body").append(c);if(!d)return a.hooks.move.drag(b,d)});return f};this.dragDragMode=function(e,b,c){var f;null==b&&(b=!0);f={id:a.getNewId(),mode:"drag",maternal:null,
element:e[0],object:c};e.addClass("fb-draggable");e.on("mousedown",function(c){c.preventDefault();if(!e.hasClass("dragging")&&(e.addClass("prepare-dragging"),a.hooks.move.drag=function(b,d){var c,g,h;if(e.hasClass("prepare-dragging")&&(e.css({width:e.width(),height:e.height()}),e.removeClass("prepare-dragging"),e.addClass("dragging"),d))return;e.offset({left:b.pageX-e.width()/2,top:b.pageY-e.height()/2});a.autoScroll.start(b);h=a.data.droppables;for(g in h)c=h[g],a.isHover(e,$(c.element))?c.move(b,
f):c.out(b,f)},a.hooks.up.drag=function(b){var d,c,g,h;h=a.data.droppables;for(c in h)d=h[c],g=a.isHover(e,$(d.element)),d.up(b,g,f);delete a.hooks.move.drag;delete a.hooks.up.drag;e.css({width:"",height:"",left:"",top:""});return e.removeClass("dragging defer-dragging")},!b))return a.hooks.move.drag(c,b)});return f};this.dropCustomMode=function(b,d){return{id:a.getNewId(),mode:"custom",element:b[0],move:function(a,b){return c.$apply(function(){return"function"===typeof d.move?d.move(a,b):void 0})},
up:function(a,b,e){return c.$apply(function(){return"function"===typeof d.up?d.up(a,b,e):void 0})},out:function(a,b){return c.$apply(function(){return"function"===typeof d.out?d.out(a,b):void 0})}}};this.draggable=function(b,d){var c,f,h,k;null==d&&(d={});f=[];if("mirror"===d.mode)for(h=0,k=b.length;h<k;h++)c=b[h],c=a.dragMirrorMode($(c),d.defer,d.object),f.push(c.id),a.data.draggables[c.id]=c;else for(h=0,k=b.length;h<k;h++)c=b[h],c=a.dragDragMode($(c),d.defer,d.object),f.push(c.id),a.data.draggables[c.id]=
c;return f};this.droppable=function(b,d){var c,f,h,k;null==d&&(d={});f=[];if("custom"===d.mode)for(h=0,k=b.length;h<k;h++)c=b[h],c=a.dropCustomMode($(c),d),f.push(c),a.data.droppables[c.id]=c;return f};this.get=function(a){this.setupEasing();this.setupProviders(a);return{isMouseMoved:this.isMouseMoved,data:this.data,draggable:this.draggable,droppable:this.droppable}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);(function(){angular.module("builder",["builder.directive"])}).call(this);
(function(){var h=[].indexOf||function(c){for(var b=0,a=this.length;b<a;b++)if(b in this&&this[b]===c)return b;return-1};angular.module("builder.provider",[]).provider("$builder",function(){var c=this;this.components={};this.groups=[];this.broadcastChannel={updateInput:"$updateInput"};this.forms={"default":[]};this.formsId={"default":0};this.setupProviders=function(b){return b};this.convertComponent=function(b,a){var c,d,g,f,h,k,l,m,p,n;c={name:b,group:null!=(d=a.group)?d:"Default",label:null!=(g=
a.label)?g:"",description:null!=(f=a.description)?f:"",placeholder:null!=(h=a.placeholder)?h:"",required:null!=(k=a.required)?k:!1,validation:null!=(l=a.validation)?l:"/.*/",errorMessage:null!=(m=a.errorMessage)?m:"",options:null!=(p=a.options)?p:[],arrayToText:null!=(n=a.arrayToText)?n:!1,template:a.template,popoverTemplate:a.popoverTemplate};c.template||console.error("template is empty");c.popoverTemplate||console.error("popoverTemplate is empty");return c};this.convertFormObject=function(b,a){var c,
d,g,f,h,k,l,m,p,n,q,s,t,u,v,w;null==a&&(a={});c=this.components[a.component];null==c&&console.error("component "+a.component+" was not registered.");if(a.id){d=!1;k=this.forms[b];f=0;for(h=k.length;f<h;f++)if(g=k[f],a.id<=g.id){a.id=this.formsId[b]++;d=!0;break}d||(this.formsId[b]=a.id+1)}return{id:null!=(l=a.id)?l:this.formsId[b]++,component:a.component,draggable:null!=(p=a.draggable)?p:!0,index:null!=(n=a.index)?n:0,label:null!=(q=a.label)?q:c.label,description:null!=(s=a.description)?s:c.description,
placeholder:null!=(t=a.placeholder)?t:c.placeholder,options:null!=(u=a.options)?u:c.options,required:null!=(v=a.required)?v:c.required,validation:null!=(w=a.validation)?w:c.validation,errorMessage:null!=(m=a.errorMessage)?m:c.errorMessage}};this.reIndexFormObject=function(b){var a,e,d;b=c.forms[b];a=e=0;for(d=b.length-1;e<=d;a=e+=1)b[a].index=a};this.registerComponent=function(b,a){var e,d;null==a&&(a={});null==c.components[b]?(e=c.convertComponent(b,a),c.components[b]=e,(d=e.group,0>h.call(c.groups,
d))&&c.groups.push(e.group)):console.error("The component "+b+" was registered.")};this.addFormObject=function(b,a){var e,d;null==a&&(a={});null==(e=c.forms)[b]&&(e[b]=[]);null==(d=c.formsId)[b]&&(d[b]=0);return c.insertFormObject(b,c.forms[b].length,a)};this.insertFormObject=function(b,a,e){var d,g;null==e&&(e={});null==(d=c.forms)[b]&&(d[b]=[]);null==(g=c.formsId)[b]&&(g[b]=0);a>c.forms.length?a=c.forms.length:0>a&&(a=0);c.forms[b].splice(a,0,c.convertFormObject(b,e));return c.reIndexFormObject(b)};
this.removeFormObject=function(b,a){c.forms[b].splice(a,1);return c.reIndexFormObject(b)};this.updateFormObjectIndex=function(b,a,e){var d;if(a!==e)return d=c.forms[b],a=d.splice(a,1)[0],d.splice(e,0,a),c.reIndexFormObject(b)};this.get=function(b){this.setupProviders(b);return{components:this.components,groups:this.groups,forms:this.forms,broadcastChannel:this.broadcastChannel,registerComponent:this.registerComponent,addFormObject:this.addFormObject,insertFormObject:this.insertFormObject,removeFormObject:this.removeFormObject,
updateFormObjectIndex:this.updateFormObjectIndex}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);
