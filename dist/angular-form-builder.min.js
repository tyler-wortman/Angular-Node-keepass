(function(){var h;h=function(a,b){var c,g;for(c in a)g=a[c],"$$hashKey"!==c&&(b[c]=g)};angular.module("builder.controller",["builder.provider"]).controller("fbFormObjectEditableController",["$scope","$injector",function(a,b){var c;c=b.get("$builder");a.setupScope=function(b){h(b,a);a.optionsText=b.options.join("\n");a.$watch("[label, description, placeholder, required, options, validation]",function(){b.label=a.label;b.description=a.description;b.placeholder=a.placeholder;b.required=a.required;b.options=
a.options;return b.validation=a.validation},!0);a.$watch("optionsText",function(c){var b,g,k,l;k=c.split("\n");l=[];b=0;for(g=k.length;b<g;b++)c=k[b],0<c.length&&l.push(c);a.options=l;return a.inputText=a.options[0]});return a.validationOptions=c.components[b.component].validationOptions};return a.data={model:null,backup:function(){return this.model={label:a.label,description:a.description,placeholder:a.placeholder,required:a.required,optionsText:a.optionsText,validation:a.validation}},rollback:function(){if(this.model)return a.label=
this.model.label,a.description=this.model.description,a.placeholder=this.model.placeholder,a.required=this.model.required,a.optionsText=this.model.optionsText,a.validation=this.model.validation}}}]).controller("fbComponentsController",["$scope","$injector",function(a,b){var c;c=b.get("$builder");a.selectGroup=function(b,d){var e,f,k,l;null!=b&&b.preventDefault();a.activeGroup=d;a.components=[];k=c.components;l=[];for(f in k)e=k[f],e.group===d&&l.push(a.components.push(e));return l};a.groups=c.groups;
a.activeGroup=a.groups[0];a.allComponents=c.components;return a.$watch("allComponents",function(){return a.selectGroup(null,a.activeGroup)})}]).controller("fbComponentController",["$scope",function(a){return a.copyObjectToScope=function(b){return h(b,a)}}]).controller("fbFormController",["$scope","$injector",function(a,b){var c;c=b.get("$builder");null==a.input&&(a.input=[]);return a.$watch("form",function(){a.input.length>a.form.length&&a.input.splice(a.form.length);return a.$broadcast(c.broadcastChannel.updateInput)},
!0)}]).controller("fbFormObjectController",["$scope","$injector",function(a,b){b.get("$builder");a.copyObjectToScope=function(c){return h(c,a)};return a.updateInput=function(c){return a.$parent.input.splice(a.$index,1,{id:a.formObject.id,label:a.formObject.label,value:null!=c?c:""})}}])}).call(this);
(function(){angular.module("builder.directive",["builder.provider","builder.controller","builder.drag","validator"]).directive("fbBuilder",["$injector",function(h){return{restrict:"A",template:"<div class='form-horizontal'>\n    <div class='fb-form-object-editable' ng-repeat=\"object in formObjects\"\n        fb-form-object-editable=\"object\"></div>\n</div>",link:function(a,b,c){var g,d,e,f,k;g=h.get("$builder");d=h.get("$drag");a.formName=c.fbBuilder;null==(f=g.forms)[k=a.formName]&&(f[k]=[]);a.formObjects=
g.forms[a.formName];e=!0;$(b).addClass("fb-builder");return d.droppable($(b),{move:function(a){var c,g,d,f,k,h;e&&($("div.fb-form-object-editable").popover("hide"),e=!1);g=$(b).find(".fb-form-object-editable:not(.empty,.dragging)");if(0===g.length)0===$(b).find(".fb-form-object-editable.empty").length&&$(b).find(">div:first").append($("<div class='fb-form-object-editable empty'></div>"));else{f=[];f.push(-1E3);d=k=0;for(h=g.length;k<h;d=k+=1)c=$(g[d]),d=c.offset(),c=c.height(),f.push(d.top+c/2);f.push(f[f.length-
1]+1E3);d=k=1;for(h=f.length-1;k<=h;d=k+=1)if(a.pageY>f[d-1]&&a.pageY<=f[d]){$(b).find(".empty").remove();a=$("<div class='fb-form-object-editable empty'></div>");d-1<g.length?a.insertBefore($(g[d-1])):a.insertAfter($(g[d-2]));break}}},out:function(){e&&($("div.fb-form-object-editable").popover("hide"),e=!1);return $(b).find(".empty").remove()},up:function(f,k,m){e=!0;if(d.isMouseMoved())return k||"drag"!==m.mode?k&&("mirror"===m.mode&&g.insertFormObject(a.formName,$(b).find(".empty").index(".fb-form-object-editable"),
{component:m.object.componentName}),"drag"===m.mode&&(k=m.object.formObject.index,f=$(b).find(".empty").index(".fb-form-object-editable"),k<f&&f--,g.updateFormObjectIndex(a.formName,k,f))):(f=m.object.formObject,f.editable&&g.removeFormObject(c.fbBuilder,f.index)),$(b).find(".empty").remove();$(b).find(".empty").remove()}})}}}]).directive("fbFormObjectEditable",["$injector",function(h){return{restrict:"A",controller:"fbFormObjectEditableController",link:function(a,b,c){var g,d,e,f,k,l,q,m;f=h.get("$builder");
l=h.get("$drag");e=h.get("$parse");k=h.get("$compile");q=h.get("$validator");a.inputArray=[];e=e(c.fbFormObjectEditable)(a);c=f.components[e.component];a.setupScope(e);m=k(c.template)(a);$(b).append(m);$(b).on("click",function(){return!1});l.draggable($(b),{object:{formObject:e}});if(e.editable)return g="fb-"+Math.random().toString().substr(2),d=!1,e=null,e=c.popoverTemplate,e=$(e).addClass(g),a.popover={save:function(c){c.preventDefault();q.validate(a).success(function(){d=!0;return $(b).popover("hide")})},
remove:function(c){c.preventDefault();f.removeFormObject(a.formName,a.$index);$(b).popover("hide")},shown:function(){a.data.backup();return d=!1},cancel:function(c){a.data.rollback();c&&(c.preventDefault(),$(b).popover("hide"))}},e=k(e)(a),$(b).addClass(g),$(b).popover({html:!0,title:c.label,content:e,container:"body"}),$(b).on("show.bs.popover",function(){var c,a;if(l.isMouseMoved())return!1;$("div.fb-form-object-editable:not(."+g+")").popover("hide");c=$("form."+g).closest(".popover");if(0<c.length)return a=
$(b).offset().top+$(b).height()/2,a-=c.height()/2,c.css({position:"absolute",top:a}),c.show(),setTimeout(function(){c.addClass("in");return $(b).triggerHandler("shown.bs.popover")},0),!1}),$(b).on("shown.bs.popover",function(){$(".popover ."+g+" input:first").select();a.$apply(function(){return a.popover.shown()})}),$(b).on("hide.bs.popover",function(){var c;c=$("form."+g).closest(".popover");d||(a.$$phase?a.popover.cancel():a.$apply(function(){return a.popover.cancel()}));c.removeClass("in");setTimeout(function(){return c.hide()},
300);return!1})}}}]).directive("fbComponents",function(){return{restrict:"A",template:'<ul ng-if="groups.length > 1" class="nav nav-tabs nav-justified">\n    <li ng-repeat="group in groups" ng-class="{active:activeGroup==group}">\n        <a href=\'#\' ng-click="selectGroup($event, group)">{{group}}</a>\n    </li>\n</ul>\n<div class=\'form-horizontal\'>\n    <div class=\'fb-component\' ng-repeat="component in components"\n        fb-component="component"></div>\n</div>',controller:"fbComponentsController"}}).directive("fbComponent",
["$injector",function(h){return{restrict:"A",controller:"fbComponentController",link:function(a,b,c){var g,d,e;h.get("$builder");d=h.get("$drag");e=h.get("$parse");g=h.get("$compile");c=e(c.fbComponent)(a);a.copyObjectToScope(c);d.draggable($(b),{mode:"mirror",defer:!1,object:{componentName:c.name}});a=g(c.template)(a);return $(b).append(a)}}}]).directive("fbForm",["$injector",function(h){return{restrict:"A",require:"ngModel",scope:{formName:"@fbForm",input:"=ngModel","default":"=fbDefault"},template:'<div class=\'fb-form-object\' ng-repeat="object in form" fb-form-object="object"></div>',
controller:"fbFormController",link:function(a,b,c){var g,d;b=h.get("$builder");null==(g=b.forms)[d=a.formName]&&(g[d]=[]);return a.form=b.forms[a.formName]}}}]).directive("fbFormObject",["$injector",function(h){return{restrict:"A",controller:"fbFormObjectController",link:function(a,b,c){var g,d,e,f;g=h.get("$builder");d=h.get("$compile");e=h.get("$parse");a.formObject=e(c.fbFormObject)(a);f=g.components[a.formObject.component];a.$on(g.broadcastChannel.updateInput,function(){return a.updateInput(a.inputText)});
f.arrayToText&&(a.inputArray=[],a.$watch("inputArray",function(c,b){var g,d;if(c!==b){g=[];for(d in a.inputArray)a.inputArray[d]&&g.push(a.options[d]);return a.inputText=g.join(", ")}},!0));a.$watch("inputText",function(){return a.updateInput(a.inputText)});a.$watch(c.fbFormObject,function(){return a.copyObjectToScope(a.formObject)},!0);c=$(f.template);c.find("[ng-model='inputText']").attr({validator:"{{validation}}"});d=d(c)(a);$(b).append(d);!f.arrayToText&&0<a.formObject.options.length&&(a.inputText=
a.formObject.options[0]);return a.$watch("default["+a.formObject.id+"]",function(c){if(c)return f.arrayToText?a.inputArray=c:a.inputText=c})}}}])}).call(this);
(function(){angular.module("builder.drag",[]).provider("$drag",function(){var h,a,b;a=h=null;this.data={draggables:{},droppables:{}};this.mouseMoved=!1;this.isMouseMoved=function(c){return function(){return c.mouseMoved}}(this);this.hooks={down:{},move:{},up:{}};this.eventMouseMove=function(){};this.eventMouseUp=function(){};$(function(c){return function(){$(document).on("mousedown",function(a){var b,e,f;c.mouseMoved=!1;f=c.hooks.down;for(e in f)b=f[e],b(a)});$(document).on("mousemove",function(a){var b,
e,f;c.mouseMoved=!0;f=c.hooks.move;for(e in f)b=f[e],b(a)});return $(document).on("mouseup",function(a){var b,e,f;f=c.hooks.up;for(e in f)b=f[e],b(a)})}}(this));this.currentId=0;this.getNewId=function(c){return function(){return""+c.currentId++}}(this);this.setupEasing=function(){return jQuery.extend(jQuery.easing,{easeOutQuad:function(c,a,b,e,f){return-e*(a/=f)*(a-2)+b}})};this.setupProviders=function(c){h=c;return a=h.get("$rootScope")};this.isHover=function(c){return function(c,a){var b,f,k,l,
h,m,n;m=c.offset();n=a.offset();k=c.width();l=c.height();b=a.width();f=a.height();h={x:!1,y:!1};h.x=m.left>n.left&&m.left<n.left+b;h.x=h.x||m.left+k>n.left&&m.left+k<n.left+b;if(!h)return!1;h.y=m.top>n.top&&m.top<n.top+f;h.y=h.y||m.top+l>n.top&&m.top+l<n.top+f;return h.x&&h.y}}(this);b=function(c,a){return setTimeout(function(){return a()},c)};this.autoScroll={up:!1,down:!1,scrolling:!1,scroll:function(c){return function(){c.autoScroll.scrolling=!0;return c.autoScroll.up?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()-
50},100,"easeOutQuad"),b(100,function(){return c.autoScroll.scroll()})):c.autoScroll.down?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()+50},100,"easeOutQuad"),b(100,function(){return c.autoScroll.scroll()})):c.autoScroll.scrolling=!1}}(this),start:function(c){return function(a){if(50>a.clientY){if(c.autoScroll.up=!0,c.autoScroll.down=!1,!c.autoScroll.scrolling)return c.autoScroll.scroll()}else if(a.clientY>$(window).innerHeight()-50){if(c.autoScroll.up=!1,c.autoScroll.down=!0,
!c.autoScroll.scrolling)return c.autoScroll.scroll()}else return c.autoScroll.up=!1,c.autoScroll.down=!1}}(this),stop:function(c){return function(){c.autoScroll.up=!1;return c.autoScroll.down=!1}}(this)};this.dragMirrorMode=function(c){return function(a,b,e){var f;null==b&&(b=!0);f={id:c.getNewId(),mode:"mirror",maternal:a[0],element:null,object:e};a.on("mousedown",function(e){var l;e.preventDefault();l=a.clone();f.element=l[0];l.addClass("fb-draggable form-horizontal prepare-dragging");c.hooks.move.drag=
function(b,e){var d,k,h,r;if(l.hasClass("prepare-dragging")&&(l.css({width:a.width(),height:a.height()}),l.removeClass("prepare-dragging"),l.addClass("dragging"),e))return;l.offset({left:b.pageX-l.width()/2,top:b.pageY-l.height()/2});c.autoScroll.start(b);h=c.data.droppables;r=[];for(k in h)d=h[k],c.isHover(l,$(d.element))?r.push(d.move(b,f)):r.push(d.out(b,f));return r};c.hooks.up.drag=function(a){var b,g,e,d;d=c.data.droppables;for(g in d)b=d[g],e=c.isHover(l,$(b.element)),b.up(a,e,f);delete c.hooks.move.drag;
delete c.hooks.up.drag;f.element=null;l.remove();return c.autoScroll.stop()};$("body").append(l);if(!b)return c.hooks.move.drag(e,b)});return f}}(this);this.dragDragMode=function(a){return function(b,d,e){var f;null==d&&(d=!0);f={id:a.getNewId(),mode:"drag",maternal:null,element:b[0],object:e};b.addClass("fb-draggable");b.on("mousedown",function(e){e.preventDefault();if(!b.hasClass("dragging")&&(b.addClass("prepare-dragging"),a.hooks.move.drag=function(e,d){var k,h,p;if(b.hasClass("prepare-dragging")&&
(b.css({width:b.width(),height:b.height()}),b.removeClass("prepare-dragging"),b.addClass("dragging"),d))return;b.offset({left:e.pageX-b.width()/2,top:e.pageY-b.height()/2});a.autoScroll.start(e);p=a.data.droppables;for(h in p)k=p[h],a.isHover(b,$(k.element))?k.move(e,f):k.out(e,f)},a.hooks.up.drag=function(e){var d,k,h,p;p=a.data.droppables;for(k in p)d=p[k],h=a.isHover(b,$(d.element)),d.up(e,h,f);delete a.hooks.move.drag;delete a.hooks.up.drag;b.css({width:"",height:"",left:"",top:""});b.removeClass("dragging defer-dragging");
return a.autoScroll.stop()},!d))return a.hooks.move.drag(e,d)});return f}}(this);this.dropMode=function(b){return function(g,d){return{id:b.getNewId(),element:g[0],move:function(b,c){return a.$apply(function(){return"function"===typeof d.move?d.move(b,c):void 0})},up:function(b,c,g){return a.$apply(function(){return"function"===typeof d.up?d.up(b,c,g):void 0})},out:function(b,c){return a.$apply(function(){return"function"===typeof d.out?d.out(b,c):void 0})}}}}(this);this.draggable=function(a){return function(b,
d){var e,f,k,h;null==d&&(d={});f=[];if("mirror"===d.mode)for(k=0,h=b.length;k<h;k++)e=b[k],e=a.dragMirrorMode($(e),d.defer,d.object),f.push(e.id),a.data.draggables[e.id]=e;else for(k=0,h=b.length;k<h;k++)e=b[k],e=a.dragDragMode($(e),d.defer,d.object),f.push(e.id),a.data.draggables[e.id]=e;return f}}(this);this.droppable=function(a){return function(b,d){var e,f,k,h;null==d&&(d={});f=[];k=0;for(h=b.length;k<h;k++)e=b[k],e=a.dropMode($(e),d),f.push(e),a.data.droppables[e.id]=e;return f}}(this);this.get=
function(a){this.setupEasing();this.setupProviders(a);return{isMouseMoved:this.isMouseMoved,data:this.data,draggable:this.draggable,droppable:this.droppable}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);(function(){angular.module("builder",["builder.directive"])}).call(this);
(function(){var h=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};angular.module("builder.provider",[]).provider("$builder",function(){this.version="0.0.1";this.components={};this.groups=[];this.broadcastChannel={updateInput:"$updateInput"};this.forms={"default":[]};this.formsId={"default":0};this.convertComponent=function(a,b){var c,g,d,e,f,k,h,q,m,n,p;c={name:a,group:null!=(g=b.group)?g:"Default",label:null!=(d=b.label)?d:"",description:null!=
(e=b.description)?e:"",placeholder:null!=(f=b.placeholder)?f:"",editable:null!=(k=b.editable)?k:!0,required:null!=(h=b.required)?h:!1,validation:null!=(q=b.validation)?q:"/.*/",validationOptions:null!=(m=b.validationOptions)?m:[],options:null!=(n=b.options)?n:[],arrayToText:null!=(p=b.arrayToText)?p:!1,template:b.template,popoverTemplate:b.popoverTemplate};c.template||console.error("The template is empty.");c.popoverTemplate||console.error("The popoverTemplate is empty.");return c};this.convertFormObject=
function(a,b){var c,g,d,e,f,h,l,q,m,n,p,s,r,t,u;null==b&&(b={});c=this.components[b.component];if(null==c)throw"The component "+b.component+" was not registered.";if(b.id){g=!1;h=this.forms[a];e=0;for(f=h.length;e<f;e++)if(d=h[e],b.id<=d.id){b.id=this.formsId[a]++;g=!0;break}g||(this.formsId[a]=b.id+1)}return{id:null!=(l=b.id)?l:this.formsId[a]++,component:b.component,editable:null!=(q=b.editable)?q:c.editable,index:null!=(m=b.index)?m:0,label:null!=(n=b.label)?n:c.label,description:null!=(p=b.description)?
p:c.description,placeholder:null!=(s=b.placeholder)?s:c.placeholder,options:null!=(r=b.options)?r:c.options,required:null!=(t=b.required)?t:c.required,validation:null!=(u=b.validation)?u:c.validation}};this.reindexFormObject=function(a){return function(b){var c,g,d;b=a.forms[b];c=g=0;for(d=b.length;g<d;c=g+=1)b[c].index=c}}(this);this.registerComponent=function(a){return function(b,c){var g,d;null==c&&(c={});null==a.components[b]?(g=a.convertComponent(b,c),a.components[b]=g,(d=g.group,0>h.call(a.groups,
d))&&a.groups.push(g.group)):console.error("The component "+b+" was registered.")}}(this);this.addFormObject=function(a){return function(b,c){var g;null==c&&(c={});null==(g=a.forms)[b]&&(g[b]=[]);return a.insertFormObject(b,a.forms[b].length,c)}}(this);this.insertFormObject=function(a){return function(b,c,g){var d,e;null==g&&(g={});null==(d=a.forms)[b]&&(d[b]=[]);null==(e=a.formsId)[b]&&(e[b]=0);c>a.forms[b].length?c=a.forms[b].length:0>c&&(c=0);a.forms[b].splice(c,0,a.convertFormObject(b,g));a.reindexFormObject(b);
return a.forms[b][c]}}(this);this.removeFormObject=function(a){return function(b,c){a.forms[b].splice(c,1);return a.reindexFormObject(b)}}(this);this.updateFormObjectIndex=function(a){return function(b,c,g){var d;if(c!==g)return d=a.forms[b],c=d.splice(c,1)[0],d.splice(g,0,c),a.reindexFormObject(b)}}(this);this.$get=this.get=function(){return{version:this.version,components:this.components,groups:this.groups,forms:this.forms,broadcastChannel:this.broadcastChannel,registerComponent:this.registerComponent,
addFormObject:this.addFormObject,insertFormObject:this.insertFormObject,removeFormObject:this.removeFormObject,updateFormObjectIndex:this.updateFormObjectIndex}}})}).call(this);
