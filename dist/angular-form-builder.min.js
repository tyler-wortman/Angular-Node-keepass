(function(){var l,b;l=angular.module("builder.controller",["builder.provider"]);b=function(c,a){return a.get("$builder")};b.$inject=["$scope","$injector"];l.controller("fbBuilderController",b);b=function(c,a){var d;d=a.get("$builder");c.selectGroup=function(a,f){var g,h,b,k;null!=a&&a.preventDefault();c.activeGroup=f;c.components=[];b=d.components;k=[];for(h in b)g=b[h],g.group===f&&k.push(c.components.push(g));return k};c.groups=d.groups;c.activeGroup=c.groups[0];c.allComponents=d.components;return c.$watch("allComponents",
function(){return c.selectGroup(null,c.activeGroup)})};b.$inject=["$scope","$injector"];l.controller("fbComponentsController",b);b=function(c,a){return a.get("$builder")};b.$inject=["$scope","$injector"];l.controller("fbFormController",b)}).call(this);
(function(){var l,b;l=angular.module("builder.directive",["builder.provider","builder.controller","builder.drag","validator.rules"]);b=function(c){return{restrict:"A",template:"<div class='form-horizontal'>\n    <div class='fb-form-object-editable' ng-repeat=\"object in formObjects\"\n        fb-form-object-editable=\"object\"></div>\n</div>",controller:"fbBuilderController",link:function(a,d,e){var f,g,h,b,k;f=c.get("$builder");g=c.get("$drag");b=e.fbBuilder;null==(k=f.forms)[b]&&(k[b]=[]);a.formObjects=
f.forms[b];h=!0;$(d).addClass("fb-builder");return g.droppable($(d),{mode:"custom",move:function(a,c){var e,f,g,b,k,m;h&&($("div.fb-form-object-editable").popover("hide"),h=!1);g=$(d).find(".fb-form-object-editable:not(.empty,.dragging)");if(0===g.length)0===$(d).find(".fb-form-object-editable.empty").length&&$(d).find(">div:first").append($("<div class='fb-form-object-editable empty'></div>"));else{e=[];e.push(-1E3);e.push($(g[0]).offset().top+$(g[0]).height()/2);b=k=0;for(m=g.length-1;k<=m;b=k+=
1)0!==b&&(f=$(g[b]),b=f.offset(),f=f.height(),e.push(b.top+f/2));e.push(e[e.length-1]+1E3);b=k=0;for(m=e.length-1;k<=m;b=k+=1)if(0!==b&&a.pageY>e[b-1]&&a.pageY<=e[b]){$(d).find(".empty").remove();e=$("<div class='fb-form-object-editable empty'></div>");b-1<g.length?e.insertBefore($(g[b-1])):e.insertAfter($(g[b-2]));break}}},out:function(a,c){h&&($("div.fb-form-object-editable").popover("hide"),h=!1);return $(d).find(".empty").remove()},up:function(a,c,k){h=!0;if(g.isMouseMoved())return c||"drag"!==
k.mode?c&&("mirror"===k.mode&&f.insertFormObject(b,$(d).find(".empty").index(".fb-form-object-editable"),{component:k.object.componentName}),"drag"===k.mode&&(c=k.object.formObject.index,a=$(d).find(".empty").index(".fb-form-object-editable"),c<a&&a--,f.updateFormObjectIndex(b,c,a))):(a=k.object.formObject,f.removeFormObject(e.fbBuilder,a.index)),$(d).find(".empty").remove()}})}}};b.$inject=["$injector"];l.directive("fbBuilder",b);b=function(c){return{restrict:"A",link:function(a,d,e){var f,b,h,m,
k,n,q,p,r;h=c.get("$builder");k=c.get("$drag");n=c.get("$parse");m=c.get("$compile");q=c.get("$validator");p=n(e.fbFormObjectEditable)(a);e=h.components[p.component];for(b in p)n=p[b],"$$hashKey"!==b&&(a[b]=n);a.optionsText=p.options.join("\n");a.$watch("[label, description, placeholder, required, options]",function(){p.label=a.label;p.description=a.description;p.placeholder=a.placeholder;p.required=a.required;return p.options=a.options},!0);a.$watch("optionsText",function(c){var d,b,e,f;e=c.split("\n");
f=[];d=0;for(b=e.length;d<b;d++)c=e[d],0<c.length&&f.push(c);a.options=f;return a.inputText=a.options[0]});k.draggable($(d),{object:{formObject:p}});b=$(e.template);b=m(b)(a);$(d).append(b);$(d).on("click",function(){return!1});r="fb-"+Math.random().toString().substr(2);f=!1;b=null;b=e.popoverTemplate;b=$(b).addClass(r);a.popover={ngModel:null,save:function(c){c.preventDefault();q.validate(a).success(function(){f=!0;return $(d).popover("hide")})},remove:function(c){c.preventDefault();c=$(d).closest("[fb-builder]").attr("fb-builder");
h.removeFormObject(c,a.$index);$(d).popover("hide")},shown:function(){this.ngModel={label:a.label,description:a.description,placeholder:a.placeholder,required:a.required,optionsText:a.optionsText};return f=!1},cancel:function(c){this.ngModel&&(a.label=this.ngModel.label,a.description=this.ngModel.description,a.placeholder=this.ngModel.placeholder,a.required=this.ngModel.required,a.optionsText=this.ngModel.optionsText);c&&(c.preventDefault(),$(d).popover("hide"))}};b=m(b)(a);$(d).addClass(r);$(d).popover({html:!0,
title:e.label,content:b,container:"body"});$(d).on("show.bs.popover",function(){var a,c;if(k.isMouseMoved())return!1;$("div.fb-form-object-editable:not(."+r+")").popover("hide");a=$("form."+r).closest(".popover");if(0<a.length)return c=$(d).offset().top+$(d).height()/2,c-=a.height()/2,a.css({position:"absolute",top:c}),a.show(),setTimeout(function(){a.addClass("in");return $(d).triggerHandler("shown.bs.popover")},0),!1});$(d).on("shown.bs.popover",function(){$(".popover ."+r+" input:first").select();
a.$apply(function(){return a.popover.shown()})});return $(d).on("hide.bs.popover",function(){var c;c=$("form."+r).closest(".popover");f||(a.$$phase?a.popover.cancel():a.$apply(function(){return a.popover.cancel()}));c.removeClass("in");setTimeout(function(){return c.hide()},300);return!1})}}};b.$inject=["$injector"];l.directive("fbFormObjectEditable",b);l.directive("fbComponents",function(){return{restrict:"A",template:'<ul ng-if="groups.length > 1" class="nav nav-tabs nav-justified">\n    <li ng-repeat="group in groups" ng-class="{active:activeGroup==group}">\n        <a href=\'#\' ng-click="selectGroup($event, group)">{{group}}</a>\n    </li>\n</ul>\n<div class=\'form-horizontal\'>\n    <div class=\'fb-component\' ng-repeat="component in components"\n        fb-component="component"></div>\n</div>',
controller:"fbComponentsController"}});b=function(c){return{restrict:"A",link:function(a,d,b){var f,g,h,m;c.get("$builder");g=c.get("$drag");h=c.get("$parse");f=c.get("$compile");m=a.$new();a=h(b.fbComponent)(a);$.extend(m,a);g.draggable($(d),{mode:"mirror",defer:!1,object:{componentName:a.name}});g=$(a.template);f=f(g)(m);return $(d).append(f)}}};b.$inject=["$injector"];l.directive("fbComponent",b);b=function(c){return{restrict:"A",require:"ngModel",scope:{input:"=ngModel"},template:'<div class=\'fb-form-object\' ng-repeat="object in form" fb-form-object="object">\n</div>',
controller:"fbFormController",link:function(a,d,b){var f;f=c.get("$builder");a.form=f.forms[b.fbForm];return a.$watch("form",function(){a.input.length>a.form.length&&a.input.splice(a.form.length);return a.$broadcast(f.broadcastChannel.updateInput)},!0)}}};b.$inject=["$injector"];l.directive("fbForm",b);b=function(c){return{restrict:"A",link:function(a,d,b){var f,g,h,m,k,n;f=c.get("$builder");g=c.get("$compile");k=c.get("$parse")(b.fbFormObject)(a);h=f.components[k.component];n=function(c){return a.$parent.input.splice(a.$index,
1,{label:k.label,value:null!=c?c:""})};m=function(){var c,d,b;b=[];for(c in k)d=k[c],"$$hashKey"!==c&&b.push(a[c]=d);return b};a.$on(f.broadcastChannel.updateInput,function(){return n()});h.arrayToText&&(a.inputArray=[],a.$watch("inputArray",function(c,d){var b,e;if(c!==d){b=[];for(e in a.inputArray)a.inputArray[e]&&b.push(a.options[e]);return a.inputText=b.join(", ")}},!0));a.$watch("inputText",function(){return n(a.inputText)});a.$watch(b.fbFormObject,function(){return m()},!0);b=$(h.template);
b.find("[ng-model='inputText']").attr({validator:"{{validation}}","validator-error":"{{errorMessage}}"});g=g(b)(a);$(d).append(g);if(!h.arrayToText&&0<k.options.length)return a.inputText=k.options[0]}}};b.$inject=["$injector"];l.directive("fbFormObject",b)}).call(this);
(function(){angular.module("builder.drag",[]).provider("$drag",function(){var l,b,c=this;b=l=null;this.data={draggables:{},droppables:{}};this.mouseMoved=!1;this.isMouseMoved=function(){return c.mouseMoved};this.hooks={down:{},move:{},up:{}};this.eventMouseMove=function(){};this.eventMouseUp=function(){};$(function(){$(document).on("mousedown",function(a){var d,b,f;c.mouseMoved=!1;f=c.hooks.down;for(b in f)d=f[b],d(a)});$(document).on("mousemove",function(a){var d,b,f;c.mouseMoved=!0;f=c.hooks.move;
for(b in f)d=f[b],d(a)});return $(document).on("mouseup",function(a){var d,b,f;f=c.hooks.up;for(b in f)d=f[b],d(a)})});this.currentId=0;this.getNewId=function(){return""+c.currentId++};this.setupProviders=function(a){l=a;return b=l.get("$rootScope")};this.isHover=function(a,c){var b,f,g,h,m,k,n;k=a.offset();n=c.offset();g=a.width();h=a.height();b=c.width();f=c.height();m={x:!1,y:!1};m.x=k.left>n.left&&k.left<n.left+b;m.x=m.x||k.left+g>n.left&&k.left+g<n.left+b;if(!m)return!1;m.y=k.top>n.top&&k.top<
n.top+f;m.y=m.y||k.top+h>n.top&&k.top+h<n.top+f;return m.x&&m.y};this.dragMirrorMode=function(a,b,e){var f;null==b&&(b=!0);f={id:c.getNewId(),mode:"mirror",maternal:a[0],element:null,object:e};a.on("mousedown",function(e){var h;e.preventDefault();h=a.clone();f.element=h[0];h.addClass("fb-draggable form-horizontal prepare-dragging");c.hooks.move.drag=function(b,d){var e,g,p,l;if(h.hasClass("prepare-dragging")&&(h.css({width:a.width(),height:a.height()}),h.removeClass("prepare-dragging"),h.addClass("dragging"),
d))return;h.offset({left:b.pageX-h.width()/2,top:b.pageY-h.height()/2});p=c.data.droppables;l=[];for(g in p)e=p[g],c.isHover(h,$(e.element))?l.push(e.move(b,f)):l.push(e.out(b,f));return l};c.hooks.up.drag=function(a){var b,d,e,g;g=c.data.droppables;for(d in g)b=g[d],e=c.isHover(h,$(b.element)),b.up(a,e,f);delete c.hooks.move.drag;delete c.hooks.up.drag;f.element=null;return h.remove()};$("body").append(h);if(!b)return c.hooks.move.drag(e,b)});return f};this.dragDragMode=function(a,b,e){var f;null==
b&&(b=!0);f={id:c.getNewId(),mode:"drag",maternal:null,element:a[0],object:e};a.addClass("fb-draggable");a.on("mousedown",function(e){e.preventDefault();if(!a.hasClass("dragging")&&(a.addClass("prepare-dragging"),c.hooks.move.drag=function(b,d){var e,g,l;if(a.hasClass("prepare-dragging")&&(a.css({width:a.width(),height:a.height()}),a.removeClass("prepare-dragging"),a.addClass("dragging"),d))return;a.offset({left:b.pageX-a.width()/2,top:b.pageY-a.height()/2});l=c.data.droppables;for(g in l)e=l[g],
c.isHover(a,$(e.element))?e.move(b,f):e.out(b,f)},c.hooks.up.drag=function(b){var d,e,g,l;l=c.data.droppables;for(e in l)d=l[e],g=c.isHover(a,$(d.element)),d.up(b,g,f);delete c.hooks.move.drag;delete c.hooks.up.drag;a.css({width:"",height:"",left:"",top:""});return a.removeClass("dragging defer-dragging")},!b))return c.hooks.move.drag(e,b)});return f};this.dropCustomMode=function(a,d){return{id:c.getNewId(),mode:"custom",element:a[0],move:function(a,c){return b.$apply(function(){return"function"===
typeof d.move?d.move(a,c):void 0})},up:function(a,c,g){return b.$apply(function(){return"function"===typeof d.up?d.up(a,c,g):void 0})},out:function(a,c){return b.$apply(function(){return"function"===typeof d.out?d.out(a,c):void 0})}}};this.draggable=function(a,b){var e,f,g,h;null==b&&(b={});f=[];if("mirror"===b.mode)for(g=0,h=a.length;g<h;g++)e=a[g],e=c.dragMirrorMode($(e),b.defer,b.object),f.push(e.id),c.data.draggables[e.id]=e;else for(g=0,h=a.length;g<h;g++)e=a[g],e=c.dragDragMode($(e),b.defer,
b.object),f.push(e.id),c.data.draggables[e.id]=e;return f};this.droppable=function(a,b){var e,f,g,h;null==b&&(b={});f=[];if("custom"===b.mode)for(g=0,h=a.length;g<h;g++)e=a[g],e=c.dropCustomMode($(e),b),f.push(e),c.data.droppables[e.id]=e;return f};this.get=function(a){this.setupProviders(a);return{isMouseMoved:this.isMouseMoved,data:this.data,draggable:this.draggable,droppable:this.droppable}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);(function(){angular.module("builder",["builder.directive"])}).call(this);
(function(){var l=[].indexOf||function(b){for(var c=0,a=this.length;c<a;c++)if(c in this&&this[c]===b)return c;return-1};angular.module("builder.provider",[]).provider("$builder",function(){var b=this;this.components={};this.groups=[];this.broadcastChannel={updateInput:"$updateInput"};this.forms={};this.forms["default"]=[];this.setupProviders=function(b){return b};this.convertComponent=function(b,a){var d,e,f,g,h,m,k,l,q,p;d={name:b,group:null!=(e=a.group)?e:"Default",label:null!=(f=a.label)?f:"",
description:null!=(g=a.description)?g:"",placeholder:null!=(h=a.placeholder)?h:"",required:null!=(m=a.required)?m:!1,validation:null!=(k=a.validation)?k:"/.*/",errorMessage:null!=(l=a.errorMessage)?l:"",options:null!=(q=a.options)?q:[],arrayToText:null!=(p=a.arrayToText)?p:!1,template:a.template,popoverTemplate:a.popoverTemplate};d.template||console.error("template is empty");d.popoverTemplate||console.error("popoverTemplate is empty");return d};this.convertFormObject=function(b,a){var d,e,f,g,h,
l,k,n,q,p;null==a&&(a={});d=this.components[a.component];null==d&&console.error("component "+a.component+" was not registered.");return{component:a.component,draggable:null!=(e=a.draggable)?e:!0,index:null!=(f=a.index)?f:0,label:null!=(g=a.label)?g:d.label,description:null!=(h=a.description)?h:d.description,placeholder:null!=(l=a.placeholder)?l:d.placeholder,options:null!=(k=a.options)?k:d.options,required:null!=(n=a.required)?n:d.required,validation:null!=(q=a.validation)?q:d.validation,errorMessage:null!=
(p=a.errorMessage)?p:d.errorMessage}};this.reIndexFormObject=function(c){var a,d,e;c=b.forms[c];a=d=0;for(e=c.length-1;d<=e;a=d+=1)c[a].index=a};this.registerComponent=function(c,a){var d,e;null==a&&(a={});null==b.components[c]?(d=b.convertComponent(c,a),b.components[c]=d,(e=d.group,0>l.call(b.groups,e))&&b.groups.push(d.group)):console.error("The component "+c+" was registered.")};this.addFormObject=function(c,a){var d;null==a&&(a={});null==(d=b.forms)[c]&&(d[c]=[]);return b.insertFormObject(c,b.forms[c].length,
a)};this.insertFormObject=function(c,a,d){var e;null==d&&(d={});null==(e=b.forms)[c]&&(e[c]=[]);a>b.forms.length?a=b.forms.length:0>a&&(a=0);b.forms[c].splice(a,0,b.convertFormObject(c,d));return b.reIndexFormObject(c)};this.removeFormObject=function(c,a){b.forms[c].splice(a,1);return b.reIndexFormObject(c)};this.updateFormObjectIndex=function(c,a,d){var e;if(a!==d)return e=b.forms[c],a=e.splice(a,1)[0],e.splice(d,0,a),b.reIndexFormObject(c)};this.get=function(b){this.setupProviders(b);return{components:this.components,
groups:this.groups,forms:this.forms,broadcastChannel:this.broadcastChannel,registerComponent:this.registerComponent,addFormObject:this.addFormObject,insertFormObject:this.insertFormObject,removeFormObject:this.removeFormObject,updateFormObjectIndex:this.updateFormObjectIndex}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);
